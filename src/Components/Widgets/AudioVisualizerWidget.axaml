<!-- Simplified Audio Visualizer Widget - KISS principle (replaces 1233-line monster) -->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels"
             xmlns:i="using:Avalonia.Xaml.Interactivity"
             xmlns:behaviors="using:BalatroSeedOracle.Behaviors"
             x:Class="BalatroSeedOracle.Components.AudioVisualizerWidget"
             x:DataType="vm:AudioVisualizerWidgetViewModel"
             x:CompileBindings="True"
             Panel.ZIndex="{Binding WidgetZIndex}">

    <!-- Single container with drag behavior -->
    <Grid HorizontalAlignment="Left" VerticalAlignment="Top">
        <i:Interaction.Behaviors>
            <behaviors:DraggableWidgetBehavior X="{Binding PositionX, Mode=TwoWay}"
                                               Y="{Binding PositionY, Mode=TwoWay}"
                                               DragHandleClass="widget-header" />
        </i:Interaction.Behaviors>

        <!-- Minimized State - Compact Icon -->
        <StackPanel IsVisible="{Binding IsMinimized}"
                    Spacing="4"
                    PointerPressed="OnMinimizedIconPressed"
                    PointerReleased="OnMinimizedIconReleased">
            <i:Interaction.Behaviors>
                <behaviors:BalatroCardSwayBehavior AmbientTilt="0.2" />
            </i:Interaction.Behaviors>

            <Border Classes="widget-container"
                    Width="64" Height="64"
                    Cursor="Hand">
                <TextBlock Text="ðŸŽ¨" FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Border>
            <TextBlock Text="Visual"
                       FontSize="10"
                       Foreground="{StaticResource White}"
                       HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Expanded State - Simple Settings Panel -->
        <Border Classes="widget-window"
                IsVisible="{Binding !IsMinimized}"
                MinWidth="320"
                MaxWidth="420">

            <Grid RowDefinitions="Auto,*">
                <!-- Header with Minimize Button -->
                <Border Grid.Row="0" Classes="widget-header" Padding="12,8">
                    <Grid ColumnDefinitions="Auto,*">
                        <Button Grid.Column="0"
                                Content="â†™"
                                Classes="widget-minimize-btn"
                                Command="{Binding MinimizeCommand}"
                                ToolTip.Tip="Minimize"
                                Margin="0,0,8,0"/>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ðŸŽ¨" FontSize="15" VerticalAlignment="Center"/>
                            <TextBlock Text="Visualizer"
                                       FontSize="13"
                                       Foreground="White"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Content Area -->
                <StackPanel Grid.Row="1" Margin="15" Spacing="16">

                    <!-- Preset Selection -->
                    <StackPanel Spacing="6">
                        <TextBlock Text="PRESET"
                                   Foreground="{StaticResource White}"
                                   FontSize="14"
                                   FontWeight="Bold"/>
                        <ComboBox SelectedItem="{Binding SelectedPreset}"
                                  ItemsSource="{Binding AvailablePresets}"
                                  HorizontalAlignment="Stretch"
                                  FontSize="13"/>
                    </StackPanel>

                    <!-- Simple Sliders Section -->
                    <Border Background="{StaticResource DarkGrey}"
                            BorderBrush="{StaticResource ModalBorder}"
                            BorderThickness="1"
                            CornerRadius="6"
                            Padding="12">
                        <StackPanel Spacing="10">
                            <TextBlock Text="QUICK CONTROLS"
                                       Foreground="{StaticResource White}"
                                       FontSize="14"
                                       FontWeight="Bold"/>

                            <!-- Intensity Slider -->
                            <Grid ColumnDefinitions="85,*,45" ColumnSpacing="8">
                                <TextBlock Grid.Column="0"
                                           Text="Intensity"
                                           Foreground="{StaticResource White}"
                                           FontSize="13"
                                           VerticalAlignment="Center"/>
                                <Slider Grid.Column="1"
                                        Minimum="0"
                                        Maximum="100"
                                        Value="{Binding Intensity}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2"
                                           Text="{Binding Intensity, StringFormat={}{0:0}%}"
                                           Foreground="{StaticResource Gold}"
                                           FontSize="13"
                                           FontWeight="Bold"
                                           TextAlignment="Right"
                                           VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Speed Slider -->
                            <Grid ColumnDefinitions="85,*,45" ColumnSpacing="8">
                                <TextBlock Grid.Column="0"
                                           Text="Speed"
                                           Foreground="{StaticResource White}"
                                           FontSize="13"
                                           VerticalAlignment="Center"/>
                                <Slider Grid.Column="1"
                                        Minimum="0"
                                        Maximum="100"
                                        Value="{Binding Speed}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2"
                                           Text="{Binding Speed, StringFormat={}{0:0}%}"
                                           Foreground="{StaticResource Gold}"
                                           FontSize="13"
                                           FontWeight="Bold"
                                           TextAlignment="Right"
                                           VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Color Shift Slider -->
                            <Grid ColumnDefinitions="85,*,45" ColumnSpacing="8">
                                <TextBlock Grid.Column="0"
                                           Text="Color Shift"
                                           Foreground="{StaticResource White}"
                                           FontSize="13"
                                           VerticalAlignment="Center"/>
                                <Slider Grid.Column="1"
                                        Minimum="0"
                                        Maximum="100"
                                        Value="{Binding ColorShift}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2"
                                           Text="{Binding ColorShift, StringFormat={}{0:0}%}"
                                           Foreground="{StaticResource Gold}"
                                           FontSize="13"
                                           FontWeight="Bold"
                                           TextAlignment="Right"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Load/Save Buttons -->
                    <StackPanel Spacing="6">
                        <TextBlock Text="PRESETS"
                                   Foreground="{StaticResource White}"
                                   FontSize="14"
                                   FontWeight="Bold"/>
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                            <Button Grid.Column="0"
                                    Content="Load..."
                                    Classes="btn-blue"
                                    Command="{Binding LoadPresetCommand}"
                                    HorizontalAlignment="Stretch"
                                    Height="32"
                                    Padding="12,6"/>
                            <Button Grid.Column="1"
                                    Content="Save As..."
                                    Classes="btn-red"
                                    Command="{Binding SavePresetCommand}"
                                    HorizontalAlignment="Stretch"
                                    Height="32"
                                    Padding="12,6"/>
                        </Grid>
                    </StackPanel>

                    <!-- Help Text -->
                    <Border Background="{StaticResource VeryDarkGrey}"
                            BorderBrush="{StaticResource ModalBorder}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="8">
                        <StackPanel Spacing="4">
                            <TextBlock Text="ðŸ’¡ Quick Start"
                                       Foreground="{StaticResource Gold}"
                                       FontSize="12"
                                       FontWeight="Bold"/>
                            <TextBlock Text="Choose a preset, then tweak Intensity, Speed, and Color."
                                       Foreground="{StaticResource LightTextGrey}"
                                       FontSize="11"
                                       TextWrapping="Wrap"/>
                            <TextBlock Text="For advanced control, edit JSON preset files directly."
                                       Foreground="{StaticResource LightTextGrey}"
                                       FontSize="11"
                                       TextWrapping="Wrap"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Border>

                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
