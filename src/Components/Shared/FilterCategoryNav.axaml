<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:nav="using:BalatroSeedOracle.Controls.Navigation"
             xmlns:vm="using:BalatroSeedOracle.ViewModels.FilterTabs"
             x:Class="BalatroSeedOracle.Components.Shared.FilterCategoryNav"
             x:DataType="vm:FilterTabViewModelBase"
             x:CompileBindings="True">

    <UserControl.Resources>
        <x:Double x:Key="FilterNavControlWidth">160</x:Double>
    </UserControl.Resources>

    <Grid RowDefinitions="Auto,8,Auto,8,*">
        <!-- Filter Name Display - width matches nav buttons -->
        <Border Grid.Row="0"
                Background="{StaticResource DarkBackground}"
                BorderThickness="0"
                CornerRadius="12"
                Padding="8,6"
                Width="{StaticResource FilterNavControlWidth}">
            <TextBlock Text="{Binding FilterName, FallbackValue='New Filter'}"
                       FontFamily="{StaticResource BalatroFont}"
                       FontSize="13"
                       Foreground="{StaticResource Gold}"
                       HorizontalAlignment="Center"
                       TextTrimming="CharacterEllipsis"/>
        </Border>

        <!-- Search Box - width matches nav buttons -->
        <TextBox Name="SearchBox"
                 Grid.Row="2"
                 Watermark="Search items..."
                 Text="{Binding SearchFilter, Mode=TwoWay}"
                 Background="{StaticResource DarkBackground}"
                 BorderThickness="0"
                 CornerRadius="8"
                 Foreground="{StaticResource White}"
                 Padding="8,6"
                 VerticalContentAlignment="Center"
                 HorizontalAlignment="Stretch"
                 Width="{StaticResource FilterNavControlWidth}"
                 FontSize="12">
            <TextBox.Styles>
                <Style Selector="TextBox /template/ TextBlock#PART_Watermark">
                    <Setter Property="Foreground" Value="{StaticResource LightGrey}"/>
                </Style>
            </TextBox.Styles>
        </TextBox>

        <!-- Category buttons with intrinsic selection arrow -->
        <StackPanel Grid.Row="4"
                    Spacing="4"
                    Name="CategoryNav"
                    DragDrop.AllowDrop="True"
                    Width="{StaticResource FilterNavControlWidth}">
            <nav:SelectableCategoryButton
                Content="Favorites"
                Classes="nav-button special"
                Category="Favorites"
                IsSelected="{Binding IsFavoritesCategorySelected}"
                Command="{Binding SelectCategoryCommand}"
                CommandParameter="Favorites"
                Width="{StaticResource FilterNavControlWidth}"/>
            <nav:SelectableCategoryButton
                Content="Joker"
                Classes="nav-button"
                Category="Joker"
                IsSelected="{Binding IsJokerCategorySelected}"
                Command="{Binding SelectCategoryCommand}"
                CommandParameter="Joker"
                Width="{StaticResource FilterNavControlWidth}"/>
            <nav:SelectableCategoryButton
                Content="Consumable"
                Classes="nav-button"
                Category="Consumable"
                IsSelected="{Binding IsConsumableCategorySelected}"
                Command="{Binding SelectCategoryCommand}"
                CommandParameter="Consumable"
                Width="{StaticResource FilterNavControlWidth}"/>
            <nav:SelectableCategoryButton
                Content="Skip Tags"
                Classes="nav-button"
                Category="SkipTag"
                IsSelected="{Binding IsSkipTagCategorySelected}"
                Command="{Binding SelectCategoryCommand}"
                CommandParameter="SkipTag"
                Width="{StaticResource FilterNavControlWidth}"/>
            <nav:SelectableCategoryButton
                Content="Boss Blind"
                Classes="nav-button"
                Category="Boss"
                IsSelected="{Binding IsBossCategorySelected}"
                Command="{Binding SelectCategoryCommand}"
                CommandParameter="Boss"
                Width="{StaticResource FilterNavControlWidth}"/>
            <nav:SelectableCategoryButton
                Content="Voucher"
                Classes="nav-button"
                Category="Voucher"
                IsSelected="{Binding IsVoucherCategorySelected}"
                Command="{Binding SelectCategoryCommand}"
                CommandParameter="Voucher"
                Width="{StaticResource FilterNavControlWidth}"/>
            <nav:SelectableCategoryButton
                Content="Standard Card"
                Classes="nav-button"
                Category="StandardCard"
                IsSelected="{Binding IsStandardCardCategorySelected}"
                Command="{Binding SelectCategoryCommand}"
                CommandParameter="StandardCard"
                Width="{StaticResource FilterNavControlWidth}"/>
        </StackPanel>

        <!-- Favorites drop overlay -->
        <Border Grid.Row="4"
                Name="FavoritesDropOverlay"
                Background="{StaticResource Gold}"
                BorderBrush="#FFFFFF"
                BorderThickness="3"
                CornerRadius="8"
                IsVisible="False"
                IsHitTestVisible="False"
                ZIndex="200">
            <Border.Styles>
                <Style Selector="Border[IsVisible=True]">
                    <Style.Animations>
                        <Animation Duration="0:0:0.8" IterationCount="Infinite">
                            <KeyFrame Cue="0%">
                                <Setter Property="BoxShadow" Value="0 0 0 0 #FFFFFF"/>
                                <Setter Property="Background" Value="{StaticResource Gold}"/>
                            </KeyFrame>
                            <KeyFrame Cue="50%">
                                <Setter Property="BoxShadow" Value="0 0 0 3 #FFFFFF"/>
                                <Setter Property="Background" Value="{StaticResource Gold}"/>
                            </KeyFrame>
                            <KeyFrame Cue="100%">
                                <Setter Property="BoxShadow" Value="0 0 0 0 #FFFFFF"/>
                                <Setter Property="Background" Value="{StaticResource Gold}"/>
                            </KeyFrame>
                        </Animation>
                    </Style.Animations>
                </Style>
            </Border.Styles>
            <Border.Effect>
                <DropShadowEffect Color="{StaticResource GoldColor}"
                                  OffsetX="0"
                                  OffsetY="0"
                                  BlurRadius="30"
                                  Opacity="1.0"/>
            </Border.Effect>
            <TextBlock Text="Add Favorite"
                       FontFamily="{StaticResource BalatroFont}"
                       FontSize="28"
                       FontWeight="ExtraBold"
                       Foreground="{StaticResource White}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       TextAlignment="Center">
                <TextBlock.Effect>
                    <DropShadowEffect Color="#000000" BlurRadius="12" OffsetX="3" OffsetY="3" Opacity="1"/>
                </TextBlock.Effect>
            </TextBlock>
        </Border>
    </Grid>
</UserControl>
