<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels.FilterTabs"
             xmlns:controls="using:BalatroSeedOracle.Controls"
             x:Class="BalatroSeedOracle.Components.FilterTabs.SaveFilterTab"
             x:DataType="vm:SaveFilterTabViewModel">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>    <!-- Left: Save Controls -->
            <ColumnDefinition Width="20"/>   <!-- Spacer -->
            <ColumnDefinition Width="*"/>    <!-- Right: Filter Test -->
        </Grid.ColumnDefinitions>
        <!-- LEFT COLUMN: Save Controls -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Header -->
                <RowDefinition Height="20"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Filter Name -->
                <RowDefinition Height="10"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Description -->
                <RowDefinition Height="20"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Preferred Deck & Stake -->
                <RowDefinition Height="20"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Current Filter Info -->
                <RowDefinition Height="20"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Action Buttons -->
                <RowDefinition Height="*"/>     <!-- Status -->
            </Grid.RowDefinitions>
            
            <!-- Header -->
            <TextBlock Grid.Row="0" 
                       Text="SAVE FILTER" 
                       FontSize="20" 
                       Foreground="{StaticResource Gold}"
                       FontFamily="{StaticResource BalatroFont}"
                       HorizontalAlignment="Center"/>
            
            <!-- Filter Name Input -->
            <StackPanel Grid.Row="2">
                <TextBlock Text="Filter Name" 
                           FontSize="14" 
                           Foreground="{StaticResource White}"
                           FontFamily="{StaticResource BalatroFont}"
                           Margin="0,0,0,5"/>
                <TextBox Text="{Binding FilterName}"
                         Watermark="Enter filter name..."
                         FontSize="14"
                         Height="32"/>
            </StackPanel>
            
            <!-- Description Input -->
            <StackPanel Grid.Row="4">
                <TextBlock Text="Description"
                           FontSize="14"
                           Foreground="{StaticResource White}"
                           FontFamily="{StaticResource BalatroFont}"
                           Margin="0,0,0,5"/>
                <TextBox Text="{Binding FilterDescription}"
                         Watermark="Enter description..."
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         FontSize="14"
                         Height="60"/>
            </StackPanel>

            <!-- Preferred Deck & Stake -->
            <StackPanel Grid.Row="6">
                <TextBlock Text="Preferred Deck &amp; Stake"
                           FontSize="14"
                           Foreground="{StaticResource White}"
                           FontFamily="{StaticResource BalatroFont}"
                           Margin="0,0,0,5"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="(Deck/stake this filter was designed for)"
                           FontSize="10"
                           Foreground="{StaticResource LightGrey}"
                           FontFamily="{StaticResource BalatroFont}"
                           Margin="0,0,0,10"
                           HorizontalAlignment="Center"/>

                <!-- Deck Selector -->
                <controls:SpinnerControl Label="Deck"
                                        SpinnerType="deck"
                                        Value="{Binding SelectedDeckIndex}"
                                        Minimum="0"
                                        Maximum="14"
                                        ReadOnly="True"
                                        DisplayValues="{Binding DeckDisplayValues}"
                                        HorizontalAlignment="Stretch"
                                        Margin="0,0,0,8"/>

                <!-- Stake Selector -->
                <controls:SpinnerControl Label="Stake"
                                        SpinnerType="stake"
                                        Value="{Binding SelectedStakeIndex}"
                                        Minimum="0"
                                        Maximum="7"
                                        ReadOnly="True"
                                        DisplayValues="{Binding StakeDisplayValues}"
                                        HorizontalAlignment="Stretch"
                                        Margin="0,0,0,0"/>
            </StackPanel>

            <!-- Action Buttons -->
            <StackPanel Grid.Row="10"
                        Orientation="Vertical"
                        Spacing="10">
                <Button Content="ðŸ’¾ SAVE"
                        Command="{Binding SaveCommand}"
                        Classes="btn-green"
                        Height="35"
                        FontSize="13"/>
                <Button Content="ðŸ“„ SAVE AS..."
                        Command="{Binding SaveAsCommand}"
                        Classes="btn-blue"
                        Height="35"
                        FontSize="13"/>
                <Button Content="ðŸ“¤ EXPORT"
                        Command="{Binding ExportCommand}"
                        Classes="btn-blue"
                        Height="35"
                        FontSize="13"/>
            </StackPanel>
            
            <!-- Status Area -->
            <Border Grid.Row="11"
                    Background="{StaticResource DarkBackground}"
                    BorderThickness="1"
                    BorderBrush="{StaticResource ModalBorder}"
                    CornerRadius="6"
                    Padding="10"
                    Margin="0,10,0,0">
                <TextBlock Text="{Binding StatusMessage}"
                           FontSize="12"
                           Foreground="{Binding StatusColor}"
                           FontFamily="{StaticResource BalatroFont}"
                           TextWrapping="Wrap"
                           HorizontalAlignment="Center"/>
            </Border>
        </Grid>
        
        <!-- RIGHT COLUMN: Filter Test -->
        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Header -->
                <RowDefinition Height="15"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Test Button -->
                <RowDefinition Height="15"/>    <!-- Spacer -->
                <RowDefinition Height="*"/>     <!-- Test Results -->
            </Grid.RowDefinitions>
            
            <!-- Header -->
            <TextBlock Grid.Row="0" 
                       Text="ðŸ§ª FILTER TEST" 
                       FontSize="18" 
                       Foreground="{StaticResource Gold}"
                       FontFamily="{StaticResource BalatroFont}"
                       HorizontalAlignment="Center"/>
            
            <!-- Test Button -->
            <Button Grid.Row="2"
                    Content="TEST FILTER"
                    Command="{Binding TestFilterCommand}"
                    Classes="btn-green"
                    Height="40"
                    FontSize="14"
                    FontFamily="{StaticResource BalatroFont}"/>
            
            <!-- Test Results Area -->
            <Border Grid.Row="4"
                    Background="{StaticResource DarkBackground}"
                    BorderThickness="2"
                    BorderBrush="{StaticResource ModalBorder}"
                    CornerRadius="8"
                    Padding="15">
                <StackPanel Spacing="12">
                    <!-- STATE 1: TESTING - Loading Spinner -->
                    <Border IsVisible="{Binding IsTestRunning}"
                            Background="{StaticResource DarkGray}"
                            BorderThickness="2"
                            BorderBrush="{StaticResource Gold}"
                            CornerRadius="8"
                            Padding="15">
                        <StackPanel Spacing="12" HorizontalAlignment="Center">
                            <TextBlock Text="âš™ TESTING FILTER..."
                                       FontSize="14"
                                       Foreground="{StaticResource Gold}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"/>
                            <ProgressBar IsIndeterminate="True"
                                         Width="200"
                                         Height="10"/>
                            <TextBlock Text="Searching for matching seeds..."
                                       FontSize="11"
                                       Foreground="{StaticResource LightGrey}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- STATE 2: SUCCESS - Filter Verified -->
                    <Border IsVisible="{Binding ShowTestSuccess}"
                            Background="{StaticResource Green}"
                            BorderThickness="2"
                            BorderBrush="{StaticResource Gold}"
                            CornerRadius="8"
                            Padding="15">
                        <StackPanel Spacing="10">
                            <!-- Success Header -->
                            <TextBlock Text="âœ“ FILTER VERIFIED"
                                       FontSize="16"
                                       Foreground="{StaticResource White}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"/>

                            <!-- Found Seed Display -->
                            <Border IsVisible="{Binding ShowFoundSeed}"
                                    Background="{StaticResource DarkBackground}"
                                    BorderThickness="1"
                                    BorderBrush="{StaticResource Gold}"
                                    CornerRadius="6"
                                    Padding="10">
                                <StackPanel Spacing="8">
                                    <TextBlock Text="FOUND SEED:"
                                               FontSize="10"
                                               Foreground="{StaticResource LightGrey}"
                                               FontFamily="{StaticResource BalatroFont}"
                                               HorizontalAlignment="Center"/>
                                    <StackPanel Orientation="Horizontal"
                                                Spacing="8"
                                                HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding FoundSeed}"
                                                   FontSize="14"
                                                   Foreground="{StaticResource Gold}"
                                                   FontFamily="Consolas"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"/>
                                        <Button Content="ðŸ“‹"
                                                Command="{Binding CopySeedCommand}"
                                                ToolTip.Tip="Copy seed to clipboard"
                                                Width="32"
                                                Height="32"
                                                Padding="0"
                                                Classes="copy-btn"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <!-- Test Stats -->
                            <TextBlock Text="{Binding TestResultMessage}"
                                       FontSize="12"
                                       Foreground="{StaticResource White}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       HorizontalAlignment="Center"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </Border>

                    <!-- STATE 3: NO MATCH - Warning -->
                    <Border IsVisible="{Binding ShowTestError}"
                            Background="{StaticResource Red}"
                            BorderThickness="2"
                            BorderBrush="{StaticResource Gold}"
                            CornerRadius="8"
                            Padding="15">
                        <StackPanel Spacing="8">
                            <TextBlock Text="âš  TEST RESULT"
                                       FontSize="14"
                                       Foreground="{StaticResource White}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"/>
                            <TextBlock Text="{Binding TestResultMessage}"
                                       FontSize="12"
                                       Foreground="{StaticResource White}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       TextWrapping="Wrap"
                                       HorizontalAlignment="Center"
                                       TextAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- STATE 4: IDLE - Ready State -->
                    <Border IsVisible="{Binding !IsTestRunning}">
                        <Border.IsVisible>
                            <MultiBinding Converter="{x:Static BoolConverters.And}">
                                <Binding Path="!IsTestRunning"/>
                                <Binding Path="!ShowTestSuccess"/>
                                <Binding Path="!ShowTestError"/>
                            </MultiBinding>
                        </Border.IsVisible>
                        <StackPanel Spacing="15">
                            <TextBlock Text="Click TEST FILTER to verify your filter"
                                       FontSize="12"
                                       Foreground="{StaticResource LightGrey}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       HorizontalAlignment="Center"
                                       TextWrapping="Wrap"
                                       TextAlignment="Center"/>

                            <!-- Ready Icon -->
                            <Border Background="{StaticResource DarkGray}"
                                    BorderThickness="2"
                                    BorderBrush="{StaticResource ModalBorder}"
                                    CornerRadius="50"
                                    Width="80"
                                    Height="80"
                                    HorizontalAlignment="Center">
                                <TextBlock Text="?"
                                           FontSize="36"
                                           Foreground="{StaticResource White}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>

                            <TextBlock Text="No test results yet"
                                       FontSize="10"
                                       Foreground="{StaticResource DarkGrey}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Verification Badge -->
                    <Border IsVisible="{Binding IsFilterVerified}"
                            Background="{StaticResource Green}"
                            BorderThickness="1"
                            BorderBrush="{StaticResource Gold}"
                            CornerRadius="12"
                            Padding="8,4"
                            HorizontalAlignment="Center"
                            Margin="0,5,0,0">
                        <TextBlock Text="âœ“ VERIFIED"
                                   FontSize="11"
                                   Foreground="{StaticResource White}"
                                   FontFamily="{StaticResource BalatroFont}"
                                   FontWeight="Bold"/>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>