<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels.FilterTabs"
             xmlns:controls="using:BalatroSeedOracle.Controls"
             x:Class="BalatroSeedOracle.Components.FilterTabs.SaveFilterTab"
             x:DataType="vm:SaveFilterTabViewModel">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>    <!-- Left: Save Controls -->
            <ColumnDefinition Width="20"/>   <!-- Spacer -->
            <ColumnDefinition Width="*"/>    <!-- Right: Filter Test -->
        </Grid.ColumnDefinitions>
        <!-- LEFT COLUMN: Save Controls -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Header -->
                <RowDefinition Height="20"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Filter Name -->
                <RowDefinition Height="10"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Description -->
                <RowDefinition Height="20"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Preferred Deck & Stake -->
                <RowDefinition Height="20"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Current Filter Info -->
                <RowDefinition Height="20"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Action Buttons -->
                <RowDefinition Height="*"/>     <!-- Status -->
            </Grid.RowDefinitions>
            
            <!-- Header -->
            <TextBlock Grid.Row="0" 
                       Text="SAVE FILTER" 
                       FontSize="20" 
                       Foreground="{StaticResource Gold}"
                       FontFamily="{StaticResource BalatroFont}"
                       HorizontalAlignment="Center"/>
            
            <!-- Filter Name Input -->
            <StackPanel Grid.Row="2">
                <TextBlock Text="Filter Name" 
                           FontSize="14" 
                           Foreground="{StaticResource White}"
                           FontFamily="{StaticResource BalatroFont}"
                           Margin="0,0,0,5"/>
                <TextBox Text="{Binding FilterName}"
                         Watermark="Enter filter name..."
                         FontSize="14"
                         Height="32"/>
            </StackPanel>
            
            <!-- Description Input -->
            <StackPanel Grid.Row="4">
                <TextBlock Text="Description"
                           FontSize="14"
                           Foreground="{StaticResource White}"
                           FontFamily="{StaticResource BalatroFont}"
                           Margin="0,0,0,5"/>
                <TextBox Text="{Binding FilterDescription}"
                         Watermark="Enter description..."
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         FontSize="14"
                         Height="60"/>
            </StackPanel>

            <!-- Preferred Deck & Stake -->
            <StackPanel Grid.Row="6">
                <TextBlock Text="Preferred Deck &amp; Stake"
                           FontSize="14"
                           Foreground="{StaticResource White}"
                           FontFamily="{StaticResource BalatroFont}"
                           Margin="0,0,0,5"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="(Deck/stake this filter was designed for)"
                           FontSize="10"
                           Foreground="{StaticResource LightGrey}"
                           FontFamily="{StaticResource BalatroFont}"
                           Margin="0,0,0,10"
                           HorizontalAlignment="Center"/>

                <!-- Deck Selector -->
                <controls:SpinnerControl Label="Deck"
                                        SpinnerType="deck"
                                        Value="{Binding $parent[UserControl].DataContext.SelectedDeckIndex}"
                                        Minimum="0"
                                        Maximum="14"
                                        ReadOnly="True"
                                        DisplayValues="{Binding $parent[UserControl].DataContext.DeckDisplayValues}"
                                        HorizontalAlignment="Stretch"
                                        Margin="0,0,0,8"/>

                <!-- Stake Selector -->
                <controls:SpinnerControl Label="Stake"
                                        SpinnerType="stake"
                                        Value="{Binding $parent[UserControl].DataContext.SelectedStakeIndex}"
                                        Minimum="0"
                                        Maximum="7"
                                        ReadOnly="True"
                                        DisplayValues="{Binding $parent[UserControl].DataContext.StakeDisplayValues}"
                                        HorizontalAlignment="Stretch"
                                        Margin="0,0,0,0"/>
            </StackPanel>

            <!-- Current Filter Info -->
            <Border Grid.Row="8"
                    Background="{StaticResource DarkBackground}"
                    BorderThickness="2"
                    BorderBrush="{StaticResource ModalBorder}"
                    CornerRadius="8"
                    Padding="10">
                <StackPanel Spacing="6">
                    <TextBlock Text="CURRENT FILTER" 
                               FontSize="14" 
                               Foreground="{StaticResource Gold}"
                               FontFamily="{StaticResource BalatroFont}"/>
                    
                    <TextBlock Text="{Binding CurrentFileName}" 
                               FontSize="12" 
                               Foreground="{StaticResource White}"
                               FontFamily="{StaticResource BalatroFont}"/>
                    
                    <TextBlock Text="{Binding LastModified}" 
                               FontSize="10" 
                               Foreground="{StaticResource White}"
                               FontFamily="{StaticResource BalatroFont}"/>
                </StackPanel>
            </Border>
            
            <!-- Action Buttons -->
            <StackPanel Grid.Row="10"
                        Orientation="Vertical"
                        Spacing="10">
                <Button Content="ðŸ’¾ SAVE"
                        Command="{Binding SaveCommand}"
                        Classes="btn-green"
                        Height="35"
                        FontSize="13"/>
                <Button Content="ðŸ“„ SAVE AS..."
                        Command="{Binding SaveAsCommand}"
                        Classes="btn-blue"
                        Height="35"
                        FontSize="13"/>
                <Button Content="ðŸ“¤ EXPORT"
                        Command="{Binding ExportCommand}"
                        Classes="btn-blue"
                        Height="35"
                        FontSize="13"/>
            </StackPanel>
            
            <!-- Status Area -->
            <Border Grid.Row="11"
                    Background="{StaticResource DarkBackground}"
                    BorderThickness="1"
                    BorderBrush="{StaticResource ModalBorder}"
                    CornerRadius="6"
                    Padding="10"
                    Margin="0,10,0,0">
                <TextBlock Text="{Binding StatusMessage}"
                           FontSize="12"
                           Foreground="{Binding StatusColor}"
                           FontFamily="{StaticResource BalatroFont}"
                           TextWrapping="Wrap"
                           HorizontalAlignment="Center"/>
            </Border>
        </Grid>
        
        <!-- RIGHT COLUMN: Filter Test -->
        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Header -->
                <RowDefinition Height="15"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Test Button -->
                <RowDefinition Height="15"/>    <!-- Spacer -->
                <RowDefinition Height="*"/>     <!-- Test Results -->
            </Grid.RowDefinitions>
            
            <!-- Header -->
            <TextBlock Grid.Row="0" 
                       Text="ðŸ§ª FILTER TEST" 
                       FontSize="18" 
                       Foreground="{StaticResource Gold}"
                       FontFamily="{StaticResource BalatroFont}"
                       HorizontalAlignment="Center"/>
            
            <!-- Test Button -->
            <Button Grid.Row="2"
                    Content="TEST FILTER"
                    Command="{Binding TestFilterCommand}"
                    Classes="btn-green"
                    Height="40"
                    FontSize="14"
                    FontFamily="{StaticResource BalatroFont}"/>
            
            <!-- Test Results Area -->
            <Border Grid.Row="4"
                    Background="{StaticResource DarkBackground}"
                    BorderThickness="2"
                    BorderBrush="{StaticResource ModalBorder}"
                    CornerRadius="8"
                    Padding="15">
                <StackPanel Spacing="10">
                    <!-- Loading Spinner -->
                    <Border IsVisible="{Binding IsTestRunning}"
                            Background="{StaticResource DarkGray}"
                            BorderThickness="1"
                            BorderBrush="{StaticResource ModalBorder}"
                            CornerRadius="6"
                            Padding="12">
                        <StackPanel Orientation="Horizontal"
                                    Spacing="10"
                                    HorizontalAlignment="Center">
                            <ProgressBar IsIndeterminate="True"
                                         Width="120"
                                         Height="8"/>
                            <TextBlock Text="Testing filter..."
                                       FontSize="12"
                                       Foreground="{StaticResource White}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Success Result -->
                    <Border IsVisible="{Binding ShowTestSuccess}"
                            Background="{StaticResource Green}"
                            BorderThickness="1"
                            BorderBrush="{StaticResource Gold}"
                            CornerRadius="6"
                            Padding="12">
                        <StackPanel Orientation="Horizontal"
                                    Spacing="8"
                                    HorizontalAlignment="Center">
                            <TextBlock Text="âœ“"
                                       FontSize="16"
                                       Foreground="{StaticResource White}"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding TestResultMessage}"
                                       FontSize="12"
                                       Foreground="{StaticResource White}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       TextWrapping="Wrap"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Error Result -->
                    <Border IsVisible="{Binding ShowTestError}"
                            Background="{StaticResource Red}"
                            BorderThickness="1"
                            BorderBrush="{StaticResource Gold}"
                            CornerRadius="6"
                            Padding="12">
                        <StackPanel Orientation="Horizontal"
                                    Spacing="8"
                                    HorizontalAlignment="Center">
                            <TextBlock Text="âœ—"
                                       FontSize="16"
                                       Foreground="{StaticResource White}"
                                      
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding TestResultMessage}"
                                       FontSize="12"
                                       Foreground="{StaticResource White}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       TextWrapping="Wrap"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Default Ready State (shown when no test is running and no results) -->
                    <StackPanel Spacing="5">
                        <StackPanel.IsVisible>
                            <Binding Path="IsTestRunning" Converter="{x:Static BoolConverters.Not}"/>
                        </StackPanel.IsVisible>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>  <!-- Status Text -->
                                <RowDefinition Height="*"/>     <!-- Results Icon -->
                            </Grid.RowDefinitions>

                            <!-- Status -->
                            <TextBlock Grid.Row="0"
                                       Text="Ready to test..."
                                       FontSize="12"
                                       Foreground="{StaticResource White}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       HorizontalAlignment="Center"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,10"/>

                            <!-- Results Icon -->
                            <Border Grid.Row="1"
                                    Background="{StaticResource DarkBackground}"
                                    CornerRadius="30"
                                    Width="50"
                                    Height="50"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                                <TextBlock Text="?"
                                           FontSize="24"
                                           Foreground="{StaticResource White}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>