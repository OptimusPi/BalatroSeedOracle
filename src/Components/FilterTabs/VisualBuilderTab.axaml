<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels.FilterTabs"
             xmlns:i="using:Avalonia.Xaml.Interactivity"
             xmlns:behaviors="using:BalatroSeedOracle.Behaviors"
             xmlns:converters="using:BalatroSeedOracle.Converters"
             x:Class="BalatroSeedOracle.Components.FilterTabs.VisualBuilderTab">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>   <!-- Left: Category Buttons (Red Sidebar) -->
            <ColumnDefinition Width="*"/>     <!-- Center: Item Grid -->
            <ColumnDefinition Width="300"/>   <!-- Right: Drop Zones -->
        </Grid.ColumnDefinitions>

        <!-- LEFT: Search + Category Buttons + Pagination -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Search -->
                <RowDefinition Height="*"/>     <!-- Category Buttons -->
                <RowDefinition Height="16"/>    <!-- Spacer -->
                <RowDefinition Height="Auto"/>  <!-- Pagination -->
            </Grid.RowDefinitions>

            <!-- Top Section: Search -->
            <StackPanel Grid.Row="0" Spacing="4">
                <!-- Search Box (full width) -->
                <TextBox Text="{Binding SearchFilter}"
                         Watermark="Search items..."
                         Height="32"
                         BorderThickness="0"
                         Background="{StaticResource SliderEmpty}"
                         Margin="0,0,8,0"/>

                <!-- Search Button (full width) -->
                <Button Content="SEARCH"
                        Classes="btn-blue"
                        Height="36"
                        FontSize="14"
                        FontWeight="Bold"
                        Margin="0,0,8,0"
                        HorizontalAlignment="Stretch"/>

                <!-- Divider -->
                <Rectangle Height="2"
                           Fill="{StaticResource ModalBorder}"
                           Opacity="0.3"
                           Margin="0,4,8,4"/>
            </StackPanel>

            <!-- Category Buttons (filtered by current page) -->
            <StackPanel Grid.Row="1" Spacing="1" Margin="0,0,8,0">
                <!-- Page 0: JOKERS -->
                <Button Content="ðŸ”¥ Faves" Classes="nav-button" Click="OnCategoryClick" Tag="Favorites"
                        IsVisible="{Binding IsJokersPage}"/>
                <Button Content="ðŸ† Legendary" Classes="nav-button" Click="OnCategoryClick" Tag="Legendary"
                        IsVisible="{Binding IsJokersPage}"/>
                <Button Content="ðŸ’Ž Rare" Classes="nav-button" Click="OnCategoryClick" Tag="Rare"
                        IsVisible="{Binding IsJokersPage}"/>
                <Button Content="ðŸ”¸ Uncommon" Classes="nav-button" Click="OnCategoryClick" Tag="Uncommon"
                        IsVisible="{Binding IsJokersPage}"/>
                <Button Content="âšª Common" Classes="nav-button" Click="OnCategoryClick" Tag="Common"
                        IsVisible="{Binding IsJokersPage}"/>

                <!-- Page 1: CONSUMABLES -->
                <Button Content="ðŸ”® Tarot" Classes="nav-button" Click="OnCategoryClick" Tag="Tarot"
                        IsVisible="{Binding IsConsumablesPage}"/>
                <Button Content="ðŸª Planet" Classes="nav-button" Click="OnCategoryClick" Tag="Planet"
                        IsVisible="{Binding IsConsumablesPage}"/>
                <Button Content="ðŸ‘» Spectral" Classes="nav-button" Click="OnCategoryClick" Tag="Spectral"
                        IsVisible="{Binding IsConsumablesPage}"/>

                <!-- Page 2: MAP -->
                <Button Content="ðŸŽŸï¸ Voucher" Classes="nav-button" Click="OnCategoryClick" Tag="Voucher"
                        IsVisible="{Binding IsMapPage}"/>
                <Button Content="ðŸ·ï¸ Tag" Classes="nav-button" Click="OnCategoryClick" Tag="Tag"
                        IsVisible="{Binding IsMapPage}"/>
                <Button Content="ðŸ‘¹ Boss" Classes="nav-button" Click="OnCategoryClick" Tag="Boss"
                        IsVisible="{Binding IsMapPage}"/>

                <!-- Page 3: CARDS -->
                <Button Content="ðŸƒ Playing Cards" Classes="nav-button" Click="OnCategoryClick" Tag="PlayingCards"
                        IsVisible="{Binding IsCardsPage}"/>
            </StackPanel>

            <!-- Bottom Section: Pagination (Challenges style) -->
            <StackPanel Grid.Row="3"
                        Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        Spacing="4">
                <Button Content="&lt;"
                        Classes="btn-red"
                        Width="44"
                        Height="36"
                        FontSize="16"
                        FontWeight="Bold"
                        Padding="0"
                        CornerRadius="8"
                        Command="{Binding PreviousPageCommand}"/>

                <!-- Page indicator -->
                <Border Background="{StaticResource Red}"
                        BorderBrush="Transparent"
                        BorderThickness="0"
                        CornerRadius="8"
                        Padding="12,8"
                        MinWidth="100"
                        VerticalAlignment="Center">
                    <TextBlock Text="{Binding PageIndicator}"
                               FontFamily="{StaticResource BalatroFont}"
                               FontSize="10"
                               FontWeight="Bold"
                               Foreground="White"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                </Border>

                <Button Content="&gt;"
                        Classes="btn-red"
                        Width="44"
                        Height="36"
                        FontSize="16"
                        FontWeight="Bold"
                        Padding="0"
                        CornerRadius="8"
                        Command="{Binding NextPageCommand}"/>
            </StackPanel>
        </Grid>

        <!-- CENTER: Clean Item Grid (No borders, flat style) -->
        <Grid Grid.Column="1" Margin="8,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Category Title + Search -->
                <RowDefinition Height="16"/>    <!-- Spacer -->
                <RowDefinition Height="*"/>     <!-- Item Grid -->
            </Grid.RowDefinitions>

            <!-- Header: Clear All button -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                <Button Content="ðŸ—‘ï¸ CLEAR ALL"
                        ToolTip.Tip="Clear all drop zones"
                        Click="OnClearAll"
                        Height="36"
                        Background="{StaticResource Red}"
                        Foreground="White"
                        FontFamily="{StaticResource BalatroFont}"
                        FontSize="12"
                        FontWeight="Bold"
                        BorderThickness="0"
                        CornerRadius="4"
                        Padding="12,0"/>
            </StackPanel>

            <!-- Item Cards Grid - Clean and flat -->
            <ScrollViewer Grid.Row="2"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Background="Transparent">
                <ItemsControl ItemsSource="{Binding FilteredItems}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="8"
                                       Cursor="Hand"
                                       PointerPressed="OnItemPointerPressed"
                                       Opacity="{Binding IsBeingDragged, Converter={x:Static converters:BoolToOpacityConverter.Dragging}}">
                                <i:Interaction.Behaviors>
                                    <!-- Enabled: Cards sway on hover and when spawned -->
                                    <behaviors:CardDragBehavior IsEnabled="True" JuiceAmount="0.4"/>
                                </i:Interaction.Behaviors>
                                <Grid>
                                    <!-- Main card image -->
                                    <Image Source="{Binding ItemImage}"
                                           Width="71"
                                           Height="95"
                                           Stretch="Uniform"
                                           HorizontalAlignment="Center"/>

                                    <!-- Legendary soul face overlay (only for SoulJoker type) -->
                                    <Image Source="{Binding SoulFaceImage}"
                                           Width="71"
                                           Height="95"
                                           Stretch="Uniform"
                                           HorizontalAlignment="Center"
                                           IsVisible="{Binding SoulFaceImage, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                                </Grid>

                                <!-- Simple name below -->
                                <TextBlock Text="{Binding DisplayName}"
                                           Foreground="{StaticResource White}"
                                           FontFamily="{StaticResource BalatroFont}"
                                           FontSize="10"
                                           HorizontalAlignment="Center"
                                           TextAlignment="Center"
                                           TextTrimming="CharacterEllipsis"
                                           Margin="0,4,0,0"
                                           MaxWidth="80"/>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </ScrollViewer>
        </Grid>

        <!-- RIGHT: Drop Zones (clean, no scrollbars!) -->
        <StackPanel Grid.Column="2" Spacing="8" VerticalAlignment="Top">
                    <!-- MUST HAVE Zone -->
                    <Border Name="MustDropZone"
                            Background="{StaticResource VeryDarkBackground}"
                            BorderThickness="0"
                            CornerRadius="8"
                            MinHeight="100"
                            MaxHeight="200"
                            Padding="8"
                            Margin="0"
                            DragDrop.AllowDrop="True">
                        <StackPanel Spacing="4">
                            <TextBlock Text="MUST HAVE"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="12"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource Green}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,4"/>
                            <ItemsControl ItemsSource="{Binding SelectedMust}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="4" Width="71" Height="95" Cursor="Hand" DoubleTapped="OnItemDoubleTapped" PointerPressed="OnDropZoneItemPointerPressed">
                                            <!-- Main card image (NO BORDER!) -->
                                            <Image Source="{Binding ItemImage}"
                                                   Width="71"
                                                   Height="95"
                                                   Stretch="Uniform"/>

                                            <!-- Soul face overlay for legendary jokers -->
                                            <Image Source="{Binding SoulFaceImage}"
                                                   Width="71"
                                                   Height="95"
                                                   Stretch="Uniform"
                                                   IsVisible="{Binding SoulFaceImage, Converter={x:Static ObjectConverters.IsNotNull}}"/>

                                            <!-- Hover-only Remove Button -->
                                            <Button Content="Ã—"
                                                    Command="{Binding $parent[UserControl].DataContext.RemoveFromMustCommand}"
                                                    CommandParameter="{Binding}"
                                                    Background="{StaticResource Red}"
                                                    Foreground="White"
                                                    FontSize="12"
                                                    FontWeight="Bold"
                                                    Width="18"
                                                    Height="18"
                                                    CornerRadius="9"
                                                    Padding="0"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Top"
                                                    Margin="0,-6,-6,0"
                                                    IsVisible="False"
                                                    Name="RemoveButton">
                                                <Button.Styles>
                                                    <Style Selector="Button:pointerover">
                                                        <Setter Property="Background" Value="{StaticResource RedHover}"/>
                                                    </Style>
                                                </Button.Styles>
                                            </Button>

                                            <Grid.Styles>
                                                <Style Selector="Grid:pointerover Button#RemoveButton">
                                                    <Setter Property="IsVisible" Value="True"/>
                                                </Style>
                                            </Grid.Styles>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- SHOULD HAVE Zone -->
                    <Border Name="ShouldDropZone"
                            Background="{StaticResource VeryDarkBackground}"
                            BorderThickness="0"
                            CornerRadius="8"
                            MinHeight="100"
                            MaxHeight="200"
                            Padding="8"
                            Margin="0"
                            DragDrop.AllowDrop="True">
                        <StackPanel Spacing="4">
                            <TextBlock Text="SHOULD HAVE"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="12"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource Blue}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,4"/>
                            <ItemsControl ItemsSource="{Binding SelectedShould}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="4" Width="71" Height="95" Cursor="Hand" DoubleTapped="OnItemDoubleTapped" PointerPressed="OnDropZoneItemPointerPressed">
                                            <!-- Main card image (NO BORDER!) -->
                                            <Image Source="{Binding ItemImage}"
                                                   Width="71"
                                                   Height="95"
                                                   Stretch="Uniform"/>

                                            <!-- Soul face overlay for legendary jokers -->
                                            <Image Source="{Binding SoulFaceImage}"
                                                   Width="71"
                                                   Height="95"
                                                   Stretch="Uniform"
                                                   IsVisible="{Binding SoulFaceImage, Converter={x:Static ObjectConverters.IsNotNull}}"/>

                                            <!-- Hover-only Remove Button -->
                                            <Button Content="Ã—"
                                                    Command="{Binding $parent[UserControl].DataContext.RemoveFromShouldCommand}"
                                                    CommandParameter="{Binding}"
                                                    Background="{StaticResource Red}"
                                                    Foreground="White"
                                                    FontSize="12"
                                                    FontWeight="Bold"
                                                    Width="18"
                                                    Height="18"
                                                    CornerRadius="9"
                                                    Padding="0"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Top"
                                                    Margin="0,-6,-6,0"
                                                    IsVisible="False"
                                                    Name="RemoveButton">
                                                <Button.Styles>
                                                    <Style Selector="Button:pointerover">
                                                        <Setter Property="Background" Value="{StaticResource RedHover}"/>
                                                    </Style>
                                                </Button.Styles>
                                            </Button>

                                            <Grid.Styles>
                                                <Style Selector="Grid:pointerover Button#RemoveButton">
                                                    <Setter Property="IsVisible" Value="True"/>
                                                </Style>
                                            </Grid.Styles>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- MUST NOT HAVE Zone -->
                    <Border Name="MustNotDropZone"
                            Background="{StaticResource VeryDarkBackground}"
                            BorderThickness="0"
                            CornerRadius="8"
                            MinHeight="100"
                            MaxHeight="200"
                            Padding="8"
                            Margin="0"
                            DragDrop.AllowDrop="True">
                        <StackPanel Spacing="4">
                            <TextBlock Text="MUST NOT HAVE"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="12"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource Red}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,4"/>
                            <ItemsControl ItemsSource="{Binding SelectedMustNot}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="4" Width="71" Height="95" Cursor="Hand" DoubleTapped="OnItemDoubleTapped" PointerPressed="OnDropZoneItemPointerPressed">
                                            <!-- Main card image (NO BORDER!) -->
                                            <Image Source="{Binding ItemImage}"
                                                   Width="71"
                                                   Height="95"
                                                   Stretch="Uniform"/>

                                            <!-- Soul face overlay for legendary jokers -->
                                            <Image Source="{Binding SoulFaceImage}"
                                                   Width="71"
                                                   Height="95"
                                                   Stretch="Uniform"
                                                   IsVisible="{Binding SoulFaceImage, Converter={x:Static ObjectConverters.IsNotNull}}"/>

                                            <!-- Hover-only Remove Button -->
                                            <Button Content="Ã—"
                                                    Command="{Binding $parent[UserControl].DataContext.RemoveFromMustNotCommand}"
                                                    CommandParameter="{Binding}"
                                                    Background="{StaticResource Red}"
                                                    Foreground="White"
                                                    FontSize="12"
                                                    FontWeight="Bold"
                                                    Width="18"
                                                    Height="18"
                                                    CornerRadius="9"
                                                    Padding="0"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Top"
                                                    Margin="0,-6,-6,0"
                                                    IsVisible="False"
                                                    Name="RemoveButton">
                                                <Button.Styles>
                                                    <Style Selector="Button:pointerover">
                                                        <Setter Property="Background" Value="{StaticResource RedHover}"/>
                                                    </Style>
                                                </Button.Styles>
                                            </Button>

                                            <Grid.Styles>
                                                <Style Selector="Grid:pointerover Button#RemoveButton">
                                                    <Setter Property="IsVisible" Value="True"/>
                                                </Style>
                                            </Grid.Styles>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
        </StackPanel>
    </Grid>
</UserControl>
