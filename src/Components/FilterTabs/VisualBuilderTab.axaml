<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels.FilterTabs"
             x:Class="BalatroSeedOracle.Components.FilterTabs.VisualBuilderTab">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>   <!-- Left: Category Buttons (Red Sidebar) -->
            <ColumnDefinition Width="*"/>     <!-- Center: Item Grid -->
            <ColumnDefinition Width="300"/>   <!-- Right: Drop Zones -->
        </Grid.ColumnDefinitions>
        
        <!-- LEFT: Clean Category Buttons (Flat Balatro style) -->
        <StackPanel Grid.Column="0" Spacing="1" Margin="0,0,8,0">
            <Button Content="ðŸ”¥ Faves" Classes="nav-button" Click="OnCategoryClick" Tag="Favorites"/>
            <Button Content="ðŸ† Legendary" Classes="nav-button" Click="OnCategoryClick" Tag="Legendary"/>
            <Button Content="ðŸ’Ž Rare" Classes="nav-button" Click="OnCategoryClick" Tag="Rare"/>
            <Button Content="ðŸ”¸ Uncommon" Classes="nav-button" Click="OnCategoryClick" Tag="Uncommon"/>
            <Button Content="âšª Common" Classes="nav-button" Click="OnCategoryClick" Tag="Common"/>
            <Button Content="ðŸŽŸï¸ Voucher" Classes="nav-button" Click="OnCategoryClick" Tag="Voucher"/>
            <Button Content="ðŸ”® Tarot" Classes="nav-button" Click="OnCategoryClick" Tag="Tarot"/>
            <Button Content="ðŸª Planet" Classes="nav-button" Click="OnCategoryClick" Tag="Planet"/>
            <Button Content="ðŸ‘» Spectral" Classes="nav-button" Click="OnCategoryClick" Tag="Spectral"/>
            <Button Content="ðŸƒ Playing Cards" Classes="nav-button" Click="OnCategoryClick" Tag="PlayingCards"/>
            <Button Content="ðŸ·ï¸ Tag" Classes="nav-button" Click="OnCategoryClick" Tag="Tag"/>
            <Button Content="ðŸ‘¹ Boss" Classes="nav-button" Click="OnCategoryClick" Tag="Boss"/>
            <Button Content="ðŸ—‘ï¸ Clear ALL" Classes="nav-button" Click="OnClearAll" Background="{StaticResource Orange}"/>
        </StackPanel>
        
        <!-- CENTER: Clean Item Grid (No borders, flat style) -->
        <Grid Grid.Column="1" Margin="8,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Category Title + Search -->
                <RowDefinition Height="16"/>    <!-- Spacer -->
                <RowDefinition Height="*"/>     <!-- Item Grid -->
            </Grid.RowDefinitions>
            
            <!-- Header: Category + Search -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0"
                           Text="{Binding CurrentCategoryDisplay}"
                           FontSize="24"
                           Foreground="{StaticResource Gold}"
                           FontFamily="{StaticResource BalatroFont}"
                           VerticalAlignment="Center"/>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <TextBox Text="{Binding SearchFilter}"
                             Watermark="Search items..."
                             Width="200"
                             Height="32"
                             BorderThickness="0"
                             Background="#2a2a2a"/>
                    <Button Content="Ã—" 
                            ToolTip.Tip="Clear search"
                            Click="OnClearSearch"
                            Width="32" Height="32"
                            Background="{StaticResource Orange}"
                            BorderThickness="0"/>
                </StackPanel>
            </Grid>
            
            <!-- Item Cards Grid - Clean and flat -->
            <ScrollViewer Grid.Row="2" 
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Background="Transparent">
                <ItemsControl ItemsSource="{Binding FilteredItems}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="8"
                                       Cursor="Hand"
                                       PointerPressed="OnItemPointerPressed">
                                <Grid>
                                    <!-- Main card image -->
                                    <Image Source="{Binding ItemImage}"
                                           Width="71"
                                           Height="95"
                                           Stretch="Uniform"
                                           HorizontalAlignment="Center"/>
                                    
                                </Grid>
                                
                                <!-- Simple name below -->
                                <TextBlock Text="{Binding DisplayName}" 
                                           Foreground="{StaticResource White}"
                                           FontFamily="{StaticResource BalatroFont}"
                                           FontSize="10"
                                           HorizontalAlignment="Center"
                                           TextAlignment="Center"
                                           TextTrimming="CharacterEllipsis"
                                           Margin="0,4,0,0"
                                           MaxWidth="80"/>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </ScrollViewer>
        </Grid>
        
        <!-- RIGHT: Drop Zones exactly like your screenshot -->
        <Border Grid.Column="2"
                Background="{StaticResource ContainerDarkPrecise}"
                BorderThickness="2"
                BorderBrush="{StaticResource ModalBorder}"
                CornerRadius="8"
                Padding="15">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Spacing="15">
                    <!-- MUST HAVE Zone (self-labeled) -->
                    <Border Name="MustDropZone"
                            Background="{StaticResource Green}"
                            CornerRadius="8"
                            MinHeight="120"
                            Padding="8"
                            Margin="0,0,0,8"
                            DragDrop.AllowDrop="True">
                            <ItemsControl ItemsSource="{Binding SelectedMust}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="4">
                                            <!-- Card exactly like screenshot -->
                                            <Border Background="{StaticResource White}" 
                                                    CornerRadius="4" 
                                                    Padding="4"
                                                    Width="60"
                                                    Height="80">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    
                                                    <Image Grid.Row="0" 
                                                           Source="{Binding ItemImage}"
                                                           Width="50"
                                                           Height="50"
                                                           Stretch="Uniform"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                                    
                                                    <TextBlock Grid.Row="1" 
                                                               Text="{Binding DisplayName}" 
                                                               Foreground="Black"
                                                               FontFamily="{StaticResource BalatroFont}"
                                                               FontSize="8"
                                                               HorizontalAlignment="Center"
                                                               TextAlignment="Center"
                                                               TextTrimming="CharacterEllipsis"/>
                                                </Grid>
                                            </Border>
                                            
                                            <!-- Hover-only Remove Button -->
                                            <Button Content="Ã—" 
                                                    Command="{Binding $parent[UserControl].DataContext.RemoveFromMustCommand}"
                                                    CommandParameter="{Binding}"
                                                    Background="{StaticResource Red}"
                                                    Foreground="White"
                                                    FontSize="12"
                                                    FontWeight="Bold"
                                                    Width="18"
                                                    Height="18"
                                                    CornerRadius="9"
                                                    Padding="0"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Top"
                                                    Margin="0,-6,-6,0"
                                                    IsVisible="False"
                                                    Name="RemoveButton">
                                                <Button.Styles>
                                                    <Style Selector="Button:pointerover">
                                                        <Setter Property="Background" Value="{StaticResource RedHover}"/>
                                                    </Style>
                                                </Button.Styles>
                                            </Button>
                                            
                                            <Grid.Styles>
                                                <Style Selector="Grid:pointerover Button#RemoveButton">
                                                    <Setter Property="IsVisible" Value="True"/>
                                                </Style>
                                            </Grid.Styles>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                    </Border>
                    
                    <!-- SHOULD HAVE Zone (self-labeled) -->
                    <Border Name="ShouldDropZone"
                            Background="{StaticResource Blue}"
                            CornerRadius="8"
                            MinHeight="120"
                            Padding="8"
                            Margin="0,0,0,8"
                            DragDrop.AllowDrop="True">
                        <TextBlock Text="Drop items you'd LIKE to see"
                                   Foreground="White"
                                   FontFamily="{StaticResource BalatroFont}"
                                   FontSize="12"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Border>
                    
                    <!-- MUST NOT HAVE Zone (self-labeled) -->
                    <Border Name="MustNotDropZone"
                            Background="{StaticResource Red}"
                            CornerRadius="8"
                            MinHeight="120"
                            Padding="8"
                            DragDrop.AllowDrop="True">
                        <TextBlock Text="Drop Forbidden items here"
                                   Foreground="White"
                                   FontFamily="{StaticResource BalatroFont}"
                                   FontSize="12"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>