<UserControl
    x:Class="BalatroSeedOracle.Components.FilterOperatorControl"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:BalatroSeedOracle.Models"
    x:DataType="models:FilterOperatorItem">

    <UserControl.Styles>
        <!-- Expansion animation on hover -->
        <Style Selector="Border#OperatorContainer:pointerover">
            <Setter Property="MinWidth" Value="320"/>
            <Setter Property="MinHeight" Value="240"/>
            <Setter Property="BorderThickness" Value="3"/>
        </Style>

        <!-- Balatro-style highlight when dragging over - white border with colored overlay -->
        <Style Selector="Border#OperatorContainer.drag-over">
            <Setter Property="BorderBrush" Value="#FFFFFF"/>
            <Setter Property="BorderThickness" Value="3"/>
            <Setter Property="MinWidth" Value="320"/>
            <Setter Property="MinHeight" Value="240"/>
        </Style>

        <!-- Semi-transparent overlay for drop zone -->
        <Style Selector="Border#ChildrenDropZone.drag-active">
            <Setter Property="Background">
                <Setter.Value>
                    <SolidColorBrush Color="#4CAF50" Opacity="0.3"/>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush" Value="#FFFFFF"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
    </UserControl.Styles>

    <Border
        Name="OperatorContainer"
        Padding="12"
        Background="{StaticResource DarkBackground}"
        BorderThickness="2"
        BorderBrush="{StaticResource Blue}"
        CornerRadius="12"
        MinWidth="240"
        MinHeight="160">
        <Border.Transitions>
            <Transitions>
                <DoubleTransition Property="MinWidth" Duration="0:0:0.3" Easing="CubicEaseOut"/>
                <DoubleTransition Property="MinHeight" Duration="0:0:0.3" Easing="CubicEaseOut"/>
                <ThicknessTransition Property="BorderThickness" Duration="0:0:0.2"/>
            </Transitions>
        </Border.Transitions>

        <Grid RowDefinitions="Auto,*">
            <!-- Operator Label Header - Flat connected style -->
            <Border
                Grid.Row="0"
                Padding="12,8"
                CornerRadius="12,12,0,0"
                HorizontalAlignment="Stretch"
                Margin="-12,-12,-12,0">
                <Border.Style>
                    <Style Selector="Border">
                        <Setter Property="Background" Value="{StaticResource Blue}"/>
                    </Style>
                    <Style Selector="^[Tag=OR]">
                        <Setter Property="Background" Value="{StaticResource Green}"/>
                    </Style>
                </Border.Style>
                <TextBlock
                    Text="{Binding OperatorType}"
                    FontSize="20"
                    FontWeight="Bold"
                    Foreground="{StaticResource White}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center" />
            </Border>

            <!-- Drop Zone for Children -->
            <Border
                Grid.Row="1"
                Name="ChildrenDropZone"
                Padding="8"
                Background="#1A1A1A"
                BorderThickness="2"
                BorderBrush="#2A2A2A"
                CornerRadius="0,0,8,8"
                MinHeight="120"
                Margin="4,8,4,4"
                DragDrop.AllowDrop="True">

                <ScrollViewer
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto">
                    <ItemsControl
                        Name="ChildrenItemsControl"
                        ItemsSource="{Binding Children}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical" Spacing="8" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <!-- Full-size card representation -->
                                <Border
                                    Padding="4"
                                    Background="{StaticResource DarkBackground}"
                                    BorderThickness="1"
                                    BorderBrush="#3A3A3A"
                                    CornerRadius="6"
                                    Width="73"
                                    Height="92"
                                    HorizontalAlignment="Center"
                                    ToolTip.Tip="{Binding DisplayName}">
                                    <Border.Styles>
                                        <Style Selector="Border:pointerover">
                                            <Setter Property="BorderBrush" Value="{StaticResource Blue}" />
                                            <Setter Property="BorderThickness" Value="2" />
                                        </Style>
                                    </Border.Styles>

                                    <Grid>
                                        <!-- Main card image -->
                                        <Image
                                            Source="{Binding ItemImage}"
                                            Width="57"
                                            Height="76"
                                            Stretch="Uniform"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center" />
                                        <!-- Soul face overlay for legendary jokers -->
                                        <Image
                                            Source="{Binding SoulFaceImage}"
                                            Width="57"
                                            Height="76"
                                            Stretch="Uniform"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            IsVisible="{Binding SoulFaceImage, Converter={x:Static ObjectConverters.IsNotNull}}" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>
        </Grid>
    </Border>
</UserControl>
