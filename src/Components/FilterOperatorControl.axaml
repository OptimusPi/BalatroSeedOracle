<UserControl
    x:Class="BalatroSeedOracle.Components.FilterOperatorControl"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:BalatroSeedOracle.Models"
    x:DataType="models:FilterOperatorItem">

    <UserControl.Styles>
        <!-- Expansion animation on hover -->
        <Style Selector="Border#OperatorContainer:pointerover">
            <Setter Property="MinWidth" Value="180"/>
            <Setter Property="MinHeight" Value="120"/>
            <Setter Property="BorderThickness" Value="3"/>
        </Style>

        <!-- Balatro-style highlight when dragging over - white border with colored overlay -->
        <Style Selector="Border#OperatorContainer.drag-over">
            <Setter Property="BorderBrush" Value="#FFFFFF"/>
            <Setter Property="BorderThickness" Value="3"/>
            <Setter Property="MinWidth" Value="180"/>
            <Setter Property="MinHeight" Value="120"/>
        </Style>

        <!-- Semi-transparent overlay for drop zone -->
        <Style Selector="Border#ChildrenDropZone.drag-active">
            <Setter Property="Background">
                <Setter.Value>
                    <SolidColorBrush Color="#4CAF50" Opacity="0.3"/>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush" Value="#FFFFFF"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
    </UserControl.Styles>

    <Border
        Name="OperatorContainer"
        Padding="8"
        Background="{StaticResource DarkBackground}"
        BorderThickness="2"
        BorderBrush="{StaticResource Blue}"
        CornerRadius="8"
        MinWidth="140"
        MinHeight="80">
        <Border.Transitions>
            <Transitions>
                <DoubleTransition Property="MinWidth" Duration="0:0:0.3" Easing="CubicEaseOut"/>
                <DoubleTransition Property="MinHeight" Duration="0:0:0.3" Easing="CubicEaseOut"/>
                <ThicknessTransition Property="BorderThickness" Duration="0:0:0.2"/>
            </Transitions>
        </Border.Transitions>

        <Grid RowDefinitions="Auto,*">
            <!-- Operator Label Header - Flat connected style -->
            <Border
                Name="OperatorHeader"
                Grid.Row="0"
                Background="{StaticResource Blue}"
                Padding="8,4"
                CornerRadius="8,8,0,0"
                HorizontalAlignment="Stretch"
                Margin="-8,-8,-8,0">
                <TextBlock
                    Text="{Binding OperatorType}"
                    FontSize="14"
                    FontFamily="{StaticResource BalatroFont}"
                    Foreground="{StaticResource White}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center" />
            </Border>

            <!-- Drop Zone for Children -->
            <Border
                Grid.Row="1"
                Name="ChildrenDropZone"
                Padding="6"
                Background="#1A1A1A"
                BorderThickness="1"
                BorderBrush="#2A2A2A"
                CornerRadius="0,0,6,6"
                MinHeight="60"
                Margin="2,6,2,2"
                DragDrop.AllowDrop="True">

                <ScrollViewer
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto">
                    <ItemsControl
                        Name="ChildrenItemsControl"
                        ItemsSource="{Binding Children}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="0" Margin="4,0" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <!-- Small fanned thumbnails like the trays -->
                                <Grid Width="24" Height="32" Margin="-8,0,0,0" ToolTip.Tip="{Binding DisplayName}">
                                    <Image
                                        Source="{Binding ItemImage}"
                                        Stretch="Uniform"/>
                                    <!-- Soul face overlay for legendary jokers -->
                                    <Image
                                        Source="{Binding SoulFaceImage}"
                                        Stretch="Uniform"
                                        IsVisible="{Binding SoulFaceImage, Converter={x:Static ObjectConverters.IsNotNull}}" />
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>
        </Grid>
    </Border>
</UserControl>
