<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:BalatroSeedOracle.Features.VibeOut"
        xmlns:controls="using:BalatroSeedOracle.Controls"
        x:Class="BalatroSeedOracle.Features.VibeOut.VibeOutView"
        x:DataType="vm:VibeOutViewModel"
        Title="VIBE OUT MODE"
        WindowState="Maximized"
        WindowStartupLocation="CenterScreen"
        Background="Black">
    
    <Window.KeyBindings>
        <KeyBinding Gesture="Escape" Command="{Binding StopVibingCommand}"/>
        <KeyBinding Gesture="Space" Command="{Binding TogglePauseCommand}"/>
        <KeyBinding Gesture="Up" Command="{Binding IncreaseVolumeCommand}"/>
        <KeyBinding Gesture="Down" Command="{Binding DecreaseVolumeCommand}"/>
        <KeyBinding Gesture="C" Command="{Binding ClearHistoryCommand}"/>
        <KeyBinding Gesture="S" Command="{Binding ToggleShaderCommand}"/>
    </Window.KeyBindings>

    <Grid>
        <!-- ðŸŽµ MUSIC-REACTIVE BALATRO BACKGROUND ðŸ”¥ -->
        <controls:BalatroShaderBackground x:Name="BalatroBackground"
                                         Theme="VibeOut"
                                         IsAnimating="True"
                                         IsVisible="{Binding ShaderType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=0}"/>

        <!-- ðŸŒ€ PSYCHEDELIC FRACTAL BACKGROUND (MilkDrop vibes) ðŸ’« -->
        <controls:PsychedelicShaderBackground x:Name="PsychedelicBackground"
                                             IsAnimating="True"
                                             IsVisible="{Binding ShaderType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=1}"/>
        
        <!-- Matrix rain overlay -->
        <ItemsControl ItemsSource="{Binding MatrixSeeds}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="vm:FallingSeed">
                    <TextBlock Text="{Binding Text}"
                               Foreground="#00FF00"
                               FontFamily="Consolas"
                               FontSize="14"
                               Opacity="{Binding Opacity}"
                               Canvas.Left="{Binding X}"
                               Canvas.Top="{Binding Y}">
                        <TextBlock.Effect>
                            <BlurEffect Radius="1"/>
                        </TextBlock.Effect>
                    </TextBlock>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
        
        <!-- Clickable seed pills -->
        <ItemsControl ItemsSource="{Binding Pills}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="vm:SeedPill">
                    <Button Content="{Binding Seed}"
                            Command="{Binding $parent[Window].((vm:VibeOutViewModel)DataContext).CopySeedCommand}"
                            CommandParameter="{Binding Seed}"
                            Canvas.Left="{Binding X}"
                            Canvas.Top="{Binding Y}"
                            Padding="8,4"
                            Background="#4400FF88"
                            BorderBrush="#00FF88"
                            BorderThickness="2"
                            Foreground="#00FF88"
                            FontFamily="{StaticResource BalatroFont}"
                            FontSize="16"
                            CornerRadius="20">
                        <Button.RenderTransform>
                            <RotateTransform Angle="{Binding Rotation}"/>
                        </Button.RenderTransform>
                        <Button.Transitions>
                            <Transitions>
                                <DoubleTransition Property="Opacity" Duration="0:0:0.3"/>
                            </Transitions>
                        </Button.Transitions>
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="#8800FF88"/>
                                <Setter Property="RenderTransform" Value="scale(1.2)"/>
                            </Style>
                        </Button.Styles>
                    </Button>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
        
        <!-- Audio State & Vibe Status -->
        <Border VerticalAlignment="Bottom"
                HorizontalAlignment="Center"
                Margin="0,0,0,50"
                Background="#22000000"
                BorderBrush="#00FF88"
                BorderThickness="1"
                CornerRadius="10"
                Padding="20,10">
            <StackPanel Orientation="Horizontal" Spacing="20">
                <TextBlock Text="{Binding VibeStatus}"
                           Foreground="#00FF88"
                           FontFamily="{StaticResource BalatroFont}"
                           FontSize="20"
                           VerticalAlignment="Center"/>

                <TextBlock Text="{Binding AudioState}"
                           Foreground="#FFD700"
                           FontFamily="{StaticResource BalatroFont}"
                           FontSize="16"
                           VerticalAlignment="Center"
                           Opacity="0.8"/>

                <TextBlock Text="{Binding CurrentSeed}"
                           Foreground="#FFD700"
                           FontFamily="{StaticResource BalatroFont}"
                           FontSize="20"
                           VerticalAlignment="Center"/>

                <!-- Shader indicator -->
                <Border Background="#22FF00FF"
                        BorderBrush="#FF00FF"
                        BorderThickness="1"
                        CornerRadius="5"
                        Padding="10,5">
                    <TextBlock Text="{Binding ShaderName, StringFormat='ðŸŒ€ {0}'}"
                               Foreground="#FF00FF"
                               FontFamily="{StaticResource BalatroFont}"
                               FontSize="14"
                               VerticalAlignment="Center"/>
                </Border>
            </StackPanel>
        </Border>
        
        <!-- Seed History Panel -->
        <Border VerticalAlignment="Top"
                HorizontalAlignment="Left"
                Margin="20"
                Background="#33000000"
                BorderBrush="#00FF88"
                BorderThickness="1"
                CornerRadius="10"
                Padding="15"
                MaxHeight="300">
            <StackPanel>
                <TextBlock Text="ðŸŒŸ RECENT SEEDS"
                           Foreground="#00FF88"
                           FontFamily="{StaticResource BalatroFont}"
                           FontSize="14"
                           Margin="0,0,0,10"/>
                <ScrollViewer MaxHeight="250">
                    <ItemsControl ItemsSource="{Binding RecentSeeds}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Content="{Binding}"
                                        Command="{Binding $parent[Window].((vm:VibeOutViewModel)DataContext).CopySeedCommand}"
                                        CommandParameter="{Binding}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Foreground="#FFD700"
                                        FontFamily="Consolas"
                                        FontSize="12"
                                        HorizontalAlignment="Left"
                                        Cursor="Hand"
                                        Padding="5,2">
                                    <Button.Styles>
                                        <Style Selector="Button:pointerover">
                                            <Setter Property="Background" Value="#22FFD700"/>
                                        </Style>
                                    </Button.Styles>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </StackPanel>
        </Border>
        
        <!-- Keybindings Help -->
        <Border VerticalAlignment="Top"
                HorizontalAlignment="Right"
                Margin="0,20,20,0"
                Background="#33000000"
                BorderBrush="#FF00FF"
                BorderThickness="1"
                CornerRadius="10"
                Padding="15">
            <StackPanel Spacing="5">
                <TextBlock Text="âŒ¨ï¸ CONTROLS"
                           Foreground="#FF00FF"
                           FontFamily="{StaticResource BalatroFont}"
                           FontSize="14"
                           Margin="0,0,0,5"/>
                <TextBlock Text="[S] Switch Shader"
                           Foreground="#00FF88"
                           FontFamily="Consolas"
                           FontSize="11"/>
                <TextBlock Text="[C] Clear History"
                           Foreground="#00FF88"
                           FontFamily="Consolas"
                           FontSize="11"/>
                <TextBlock Text="[Space] Pause/Resume"
                           Foreground="#00FF88"
                           FontFamily="Consolas"
                           FontSize="11"/>
                <TextBlock Text="[â†‘/â†“] Volume"
                           Foreground="#00FF88"
                           FontFamily="Consolas"
                           FontSize="11"/>
                <TextBlock Text="[Esc] Exit"
                           Foreground="#00FF88"
                           FontFamily="Consolas"
                           FontSize="11"/>
            </StackPanel>
        </Border>

        <!-- 8-Track Mixer Panel (Left Side) -->
        <Border VerticalAlignment="Bottom"
                HorizontalAlignment="Left"
                Margin="20,0,0,20"
                Background="#22000000"
                BorderBrush="#FF00FF"
                BorderThickness="2"
                CornerRadius="10"
                Padding="15">
            <StackPanel Spacing="8">
                <TextBlock Text="ðŸŽ›ï¸ MIXER"
                           Foreground="#FF00FF"
                           FontFamily="{StaticResource BalatroFont}"
                           FontSize="16"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,5"/>

                <!-- Drums 1 -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Drums 1" Foreground="#FF4444" FontSize="12" VerticalAlignment="Center"/>
                    <Slider Grid.Column="1" Value="{Binding Drums1Volume}" Minimum="0" Maximum="1" SmallChange="0.01"/>
                    <TextBlock Grid.Column="2" Text="{Binding Drums1Volume, StringFormat='{}{0:P0}'}" Foreground="#FFD700" FontSize="11" VerticalAlignment="Center"/>
                </Grid>

                <!-- Drums 2 -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Drums 2" Foreground="#FF4444" FontSize="12" VerticalAlignment="Center"/>
                    <Slider Grid.Column="1" Value="{Binding Drums2Volume}" Minimum="0" Maximum="1" SmallChange="0.01"/>
                    <TextBlock Grid.Column="2" Text="{Binding Drums2Volume, StringFormat='{}{0:P0}'}" Foreground="#FFD700" FontSize="11" VerticalAlignment="Center"/>
                </Grid>

                <!-- Bass 1 -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Bass 1" Foreground="#4444FF" FontSize="12" VerticalAlignment="Center"/>
                    <Slider Grid.Column="1" Value="{Binding Bass1Volume}" Minimum="0" Maximum="1" SmallChange="0.01"/>
                    <TextBlock Grid.Column="2" Text="{Binding Bass1Volume, StringFormat='{}{0:P0}'}" Foreground="#FFD700" FontSize="11" VerticalAlignment="Center"/>
                </Grid>

                <!-- Bass 2 -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Bass 2" Foreground="#4444FF" FontSize="12" VerticalAlignment="Center"/>
                    <Slider Grid.Column="1" Value="{Binding Bass2Volume}" Minimum="0" Maximum="1" SmallChange="0.01"/>
                    <TextBlock Grid.Column="2" Text="{Binding Bass2Volume, StringFormat='{}{0:P0}'}" Foreground="#FFD700" FontSize="11" VerticalAlignment="Center"/>
                </Grid>

                <!-- Chords 1 -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Chords 1" Foreground="#44FF44" FontSize="12" VerticalAlignment="Center"/>
                    <Slider Grid.Column="1" Value="{Binding Chords1Volume}" Minimum="0" Maximum="1" SmallChange="0.01"/>
                    <TextBlock Grid.Column="2" Text="{Binding Chords1Volume, StringFormat='{}{0:P0}'}" Foreground="#FFD700" FontSize="11" VerticalAlignment="Center"/>
                </Grid>

                <!-- Chords 2 -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Chords 2" Foreground="#44FF44" FontSize="12" VerticalAlignment="Center"/>
                    <Slider Grid.Column="1" Value="{Binding Chords2Volume}" Minimum="0" Maximum="1" SmallChange="0.01"/>
                    <TextBlock Grid.Column="2" Text="{Binding Chords2Volume, StringFormat='{}{0:P0}'}" Foreground="#FFD700" FontSize="11" VerticalAlignment="Center"/>
                </Grid>

                <!-- Melody 1 -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Melody 1" Foreground="#FF44FF" FontSize="12" VerticalAlignment="Center"/>
                    <Slider Grid.Column="1" Value="{Binding Melody1Volume}" Minimum="0" Maximum="1" SmallChange="0.01"/>
                    <TextBlock Grid.Column="2" Text="{Binding Melody1Volume, StringFormat='{}{0:P0}'}" Foreground="#FFD700" FontSize="11" VerticalAlignment="Center"/>
                </Grid>

                <!-- Melody 2 -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Melody 2" Foreground="#FF44FF" FontSize="12" VerticalAlignment="Center"/>
                    <Slider Grid.Column="1" Value="{Binding Melody2Volume}" Minimum="0" Maximum="1" SmallChange="0.01"/>
                    <TextBlock Grid.Column="2" Text="{Binding Melody2Volume, StringFormat='{}{0:P0}'}" Foreground="#FFD700" FontSize="11" VerticalAlignment="Center"/>
                </Grid>

                <!-- Master Volume -->
                <Border BorderBrush="#00FF88" BorderThickness="0,1,0,0" Padding="0,8,0,0" Margin="0,5,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="40"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="ðŸ”Š Master" Foreground="#00FF88" FontSize="12" FontWeight="Bold" VerticalAlignment="Center"/>
                        <Slider Grid.Column="1" Value="{Binding MasterVolume}" Minimum="0" Maximum="1" SmallChange="0.01"/>
                        <TextBlock Grid.Column="2" Text="{Binding MasterVolume, StringFormat='{}{0:P0}'}" Foreground="#FFD700" FontSize="11" VerticalAlignment="Center"/>
                    </Grid>
                </Border>
            </StackPanel>
        </Border>
        
        <!-- Exit button -->
        <Button Content="EXIT VIBE [ESC]" 
                Command="{Binding StopVibingCommand}"
                VerticalAlignment="Top" 
                HorizontalAlignment="Right"
                Margin="20"
                Opacity="0.3"
                Background="#88000000"
                BorderBrush="#FF0000"
                BorderThickness="2"
                Foreground="#FF0000"
                FontFamily="{StaticResource BalatroFont}"
                FontSize="16"
                Padding="15,8"
                CornerRadius="5">
            <Button.Transitions>
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.2"/>
                </Transitions>
            </Button.Transitions>
            <Button.Styles>
                <Style Selector="Button:pointerover">
                    <Setter Property="Opacity" Value="0.8"/>
                </Style>
            </Button.Styles>
        </Button>
    </Grid>
</Window>