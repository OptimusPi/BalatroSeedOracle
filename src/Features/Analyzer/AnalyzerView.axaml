<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels"
             xmlns:controls="using:BalatroSeedOracle.Controls"
             xmlns:conv="using:BalatroSeedOracle.Converters"
             xmlns:features="using:BalatroSeedOracle.Features.Analyzer"
             xmlns:components="using:BalatroSeedOracle.Components"
             x:Class="BalatroSeedOracle.Features.Analyzer.AnalyzerView"
             x:DataType="vm:AnalyzerViewModel">

    <UserControl.Resources>
        <conv:ItemTypeToSpriteConverter x:Key="ItemTypeToSprite"/>
    </UserControl.Resources>

    <Design.DataContext>
        <vm:AnalyzerViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,Auto,*,Auto">

        <!-- Header: Deck/Stake Selectors & Result Counter -->
        <Border Grid.Row="0"
                Background="#1A1A1A"
                BorderBrush="#FFD700"
                BorderThickness="0,0,0,2"
                Padding="20">
            <Grid ColumnDefinitions="Auto,20,Auto,*,Auto">

                <!-- Unified Deck & Stake Selector (Balatro-style) -->
                <components:DeckAndStakeSelector x:Name="DeckStakeSelector"
                                                 Grid.Column="0"
                                                 Grid.ColumnSpan="3"
                                                 HorizontalAlignment="Left"/>

                <!-- Result Counter (Right side) -->
                <StackPanel Grid.Column="4"
                            Spacing="5"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center">
                    <TextBlock Text="{Binding ResultCounter}"
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="#FFD700"
                               HorizontalAlignment="Right"/>
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <Button Content="â—€ PgUp"
                                Command="{Binding PreviousResultCommand}"
                                IsEnabled="{Binding HasPreviousResult}"
                                ToolTip.Tip="Previous Seed (PgUp)"/>
                        <Button Content="PgDn â–¶"
                                Command="{Binding NextResultCommand}"
                                IsEnabled="{Binding HasNextResult}"
                                ToolTip.Tip="Next Seed (PgDn)"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Current Seed Display -->
        <Border Grid.Row="1"
                Background="#252525"
                Padding="20,10">
            <Grid ColumnDefinitions="Auto,*">
                <TextBlock Grid.Column="0"
                           Text="SEED: "
                           FontSize="18"
                           FontWeight="Bold"
                           Foreground="#888"/>
                <TextBlock Grid.Column="1"
                           Text="{Binding CurrentSeed}"
                           FontSize="18"
                           FontWeight="Bold"
                           Foreground="#FFD700"
                           Margin="5,0,0,0"/>
            </Grid>
        </Border>

        <!-- Main Analysis Area (Scrollable Antes) -->
        <ScrollViewer Grid.Row="2"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">

            <StackPanel Spacing="20" Margin="20">

                <!-- Loading Indicator -->
                <Border IsVisible="{Binding IsAnalyzing}"
                        Background="#1A1A1A"
                        BorderBrush="#FFD700"
                        BorderThickness="2"
                        CornerRadius="8"
                        Padding="40">
                    <TextBlock Text="ðŸƒ Analyzing seed..."
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="#FFD700"
                               HorizontalAlignment="Center"/>
                </Border>

                <!-- Shared Analysis Display (when not analyzing) -->
                <features:SeedAnalysisDisplay DataContext="{Binding DisplayAnalysis}"
                                             IsVisible="{Binding !IsAnalyzing}"/>

            </StackPanel>
        </ScrollViewer>

        <!-- Bottom Navigation -->
        <Border Grid.Row="3"
                Background="#1A1A1A"
                BorderBrush="#FFD700"
                BorderThickness="0,2,0,0"
                Padding="20,10">
            <Grid ColumnDefinitions="*,Auto,*">

                <!-- Ante Navigation -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="15"
                            HorizontalAlignment="Center">
                    <Button Content="â–² Prev Ante"
                            Command="{Binding ScrollUpAnteCommand}"
                            ToolTip.Tip="Previous Ante (â†‘)"/>
                    <TextBlock Text="{Binding AnteNavigationDisplay}"
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="#FFD700"
                               VerticalAlignment="Center"/>
                    <Button Content="Next Ante â–¼"
                            Command="{Binding ScrollDownAnteCommand}"
                            ToolTip.Tip="Next Ante (â†“)"/>
                </StackPanel>

                <!-- Load More (Right side) -->
                <Button Grid.Column="2"
                        Content="Load Ante 9+"
                        Command="{Binding LoadMoreAntesCommand}"
                        HorizontalAlignment="Right"
                        IsEnabled="False"
                        ToolTip.Tip="Placeholder for Ante 9+ support"/>
            </Grid>
        </Border>

    </Grid>
</UserControl>
