<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels"
             xmlns:controls="using:BalatroSeedOracle.Controls"
             xmlns:conv="using:BalatroSeedOracle.Converters"
             xmlns:features="using:BalatroSeedOracle.Features.Analyzer"
             xmlns:components="using:BalatroSeedOracle.Components"
             x:Class="BalatroSeedOracle.Features.Analyzer.AnalyzerView"
             x:DataType="vm:AnalyzerViewModel">

    <UserControl.Resources>
        <conv:ItemTypeToSpriteConverter x:Key="ItemTypeToSprite"/>
    </UserControl.Resources>

    <Design.DataContext>
        <vm:AnalyzerViewModel/>
    </Design.DataContext>

    <!-- Two-column layout: Settings Panel (left) + Analysis Display (right) -->
    <Grid ColumnDefinitions="220,*">

        <!-- Left: Settings Panel (Fixed Width) -->
        <Border Grid.Column="0"
                Background="{StaticResource DarkBackground}"
                BorderBrush="{StaticResource ModalBorder}"
                BorderThickness="0,0,2,0"
                Padding="16">
            <StackPanel Spacing="16">

                <!-- Seed Display -->
                <TextBlock Text="SEED ANALYZER"
                           FontFamily="{StaticResource BalatroFont}"
                           FontSize="16"
                           Foreground="{StaticResource Orange}"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,8"/>

                <Border Background="{StaticResource VeryDarkBackground}"
                        CornerRadius="6"
                        Padding="12,8">
                    <StackPanel Spacing="4">
                        <TextBlock Text="Current Seed"
                                   FontSize="10"
                                   Foreground="{StaticResource TextInactive}"/>
                        <TextBlock Text="{Binding CurrentSeed}"
                                   FontFamily="{StaticResource BalatroFont}"
                                   FontSize="18"
                                   Foreground="{StaticResource White}"
                                   TextWrapping="Wrap"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Deck & Stake Selector (Compact) -->
                <components:DeckAndStakeSelector x:Name="DeckStakeSelector"
                                                 HorizontalAlignment="Stretch"/>

                <!-- Navigation Info -->
                <Border Background="{StaticResource VeryDarkBackground}"
                        CornerRadius="6"
                        Padding="8">
                    <StackPanel Spacing="8">
                        <TextBlock Text="{Binding ResultCounter}"
                                   FontSize="12"
                                   Foreground="{StaticResource White}"
                                   HorizontalAlignment="Center"
                                   TextWrapping="Wrap"/>
                        <StackPanel Orientation="Horizontal"
                                    Spacing="6"
                                    HorizontalAlignment="Center">
                            <Button Content="◀"
                                    Command="{Binding PreviousResultCommand}"
                                    IsEnabled="{Binding HasPreviousResult}"
                                    ToolTip.Tip="Previous Seed (PgUp)"
                                    Width="40"
                                    Padding="4"/>
                            <Button Content="▶"
                                    Command="{Binding NextResultCommand}"
                                    IsEnabled="{Binding HasNextResult}"
                                    ToolTip.Tip="Next Seed (PgDn)"
                                    Width="40"
                                    Padding="4"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Ante Navigation -->
                <Border Background="{StaticResource VeryDarkBackground}"
                        CornerRadius="6"
                        Padding="8">
                    <StackPanel Spacing="8">
                        <TextBlock Text="{Binding AnteNavigationDisplay}"
                                   FontSize="12"
                                   Foreground="{StaticResource White}"
                                   HorizontalAlignment="Center"/>
                        <StackPanel Orientation="Horizontal"
                                    Spacing="6"
                                    HorizontalAlignment="Center">
                            <Button Content="▲"
                                    Command="{Binding ScrollUpAnteCommand}"
                                    ToolTip.Tip="Previous Ante (↑)"
                                    Width="40"
                                    Padding="4"/>
                            <Button Content="▼"
                                    Command="{Binding ScrollDownAnteCommand}"
                                    ToolTip.Tip="Next Ante (↓)"
                                    Width="40"
                                    Padding="4"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Copy Blueprint URL Button -->
                <Button Content="COPY URL"
                        Command="{Binding CopyBlueprintUrlCommand}"
                        Classes="btn-orange"
                        HorizontalAlignment="Stretch"
                        Padding="12,8"
                        ToolTip.Tip="Copy Blueprint-compatible URL to clipboard">
                    <Button.Styles>
                        <Style Selector="Button.btn-orange">
                            <Setter Property="Background" Value="{StaticResource Orange}"/>
                            <Setter Property="Foreground" Value="{StaticResource White}"/>
                            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
                            <Setter Property="FontSize" Value="14"/>
                            <Setter Property="CornerRadius" Value="6"/>
                        </Style>
                        <Style Selector="Button.btn-orange:pointerover">
                            <Setter Property="Background" Value="{StaticResource OrangeHover}"/>
                        </Style>
                    </Button.Styles>
                </Button>

                <!-- Spacer -->
                <Border Height="20"/>

            </StackPanel>
        </Border>

        <!-- Right: Main Analysis Display Area -->
        <Grid Grid.Column="1" RowDefinitions="*">

            <!-- Scrollable Antes -->
            <ScrollViewer VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">

                <StackPanel Spacing="20" Margin="20">

                    <!-- Loading Indicator -->
                    <Border IsVisible="{Binding IsAnalyzing}"
                            Classes="info-panel"
                            Padding="40">
                        <StackPanel Spacing="12" HorizontalAlignment="Center">
                            <TextBlock Text="Analyzing seed..."
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="24"
                                       Foreground="{StaticResource White}"
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="Calculating ante distributions..."
                                       FontSize="14"
                                       Foreground="{StaticResource TextInactive}"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Shared Analysis Display (when not analyzing) -->
                    <features:SeedAnalysisDisplay DataContext="{Binding DisplayAnalysis}"
                                                 IsVisible="{Binding !IsAnalyzing}"/>

                </StackPanel>
            </ScrollViewer>

        </Grid>

    </Grid>
</UserControl>
