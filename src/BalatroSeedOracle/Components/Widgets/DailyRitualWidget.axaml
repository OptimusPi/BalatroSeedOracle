<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels"
             xmlns:i="using:Avalonia.Xaml.Interactivity"
             xmlns:behaviors="using:BalatroSeedOracle.Behaviors"
             xmlns:local="using:BalatroSeedOracle.Components"
             xmlns:material="clr-namespace:IconPacks.Avalonia.Material;assembly=IconPacks.Avalonia.Material"
             x:Class="BalatroSeedOracle.Components.DailyRitualWidget"
             x:DataType="vm:DailyRitualWidgetViewModel"
             x:CompileBindings="True"
             Panel.ZIndex="{Binding WidgetZIndex}">

    <UserControl.Styles>
        <Style Selector="Button.hero-card">
            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
    </UserControl.Styles>

    <Grid HorizontalAlignment="Left" VerticalAlignment="Top">
        <i:Interaction.Behaviors>
            <behaviors:DraggableWidgetBehavior X="{Binding PositionX, Mode=TwoWay}"
                                               Y="{Binding PositionY, Mode=TwoWay}"
                                               DragHandleClass="widget-header" />
        </i:Interaction.Behaviors>

        <!-- Minimized View -->
        <Grid Name="MinimizedView" IsVisible="{Binding IsMinimized}">
            <i:Interaction.Behaviors>
                <behaviors:BalatroCardSwayBehavior AmbientTilt="0.2" />
            </i:Interaction.Behaviors>
            <Border Background="{StaticResource PrimaryBlue}"
                    BorderBrush="{StaticResource ModalBorder}"
                    BorderThickness="2"
                    CornerRadius="8"
                    Width="64" Height="64"
                    Classes="widget-header"
                    Cursor="Hand"
                    PointerPressed="OnMinimizedIconPressed"
                    PointerReleased="OnMinimizedIconReleased">
                <material:PackIconMaterial Kind="CardsPlayingOutline" Width="32" Height="32" 
                                         HorizontalAlignment="Center" VerticalAlignment="Center" 
                                         Foreground="{StaticResource White}"/>
            </Border>
        </Grid>

        <!-- Expanded View -->
        <Border Name="ExpandedView"
                Classes="widget-window"
                Width="400"
                IsVisible="{Binding !IsMinimized}">
            <Grid RowDefinitions="Auto,*">
                <local:WidgetHeader Grid.Row="0" />
                
                <StackPanel Grid.Row="1" Spacing="10" Margin="15">
                    <!-- Date Navigation -->
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Button Grid.Column="0" Command="{Binding PrevDayCommand}" Classes="btn-icon">
                            <material:PackIconMaterial Kind="ChevronLeft" />
                        </Button>
                        <TextBlock Grid.Column="1" Text="{Binding DateText}" 
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   FontSize="16" FontWeight="Bold"/>
                        <Button Grid.Column="2" Command="{Binding NextDayCommand}" Classes="btn-icon">
                            <material:PackIconMaterial Kind="ChevronRight" />
                        </Button>
                    </Grid>

                    <!-- Hero Card Area -->
                    <Border Height="200" Background="{StaticResource DarkBackground}" CornerRadius="8" ClipToBounds="True">
                        <Grid>
                            <!-- Placeholder for Hero Card content -->
                            <TextBlock Text="{Binding MinigameTitle}" 
                                       HorizontalAlignment="Center" VerticalAlignment="Top" 
                                       Margin="0,10" FontSize="18" Foreground="{StaticResource PrimaryRed}"/>
                            
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="5">
                                <TextBlock Text="{Binding CurrentSeed}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource White}"/>
                                <Button Content="COPY SEED" Command="{Binding CopySeedCommand}" Classes="btn-blue"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
