<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels"
             xmlns:controls="using:BalatroSeedOracle.Controls"
             x:Class="BalatroSeedOracle.Views.SearchModalTabs.SearchTab"
             x:DataType="vm:SearchModalViewModel"
             x:CompileBindings="True">

    <UserControl.Styles>

        <!-- Terminal style for console -->
        <Style Selector="TextBox.terminal">
            <Setter Property="Background" Value="{StaticResource TerminalBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource SpecialGreenText}"/>
            <Setter Property="FontFamily" Value="Cascadia Code, Consolas, monospace"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <!-- Keep same background when focused -->
        <Style Selector="TextBox.terminal:focus /template/ Border#PART_BorderElement">
            <Setter Property="Background" Value="{StaticResource TerminalBackground}"/>
        </Style>

        <!-- Keep same background when hovered -->
        <Style Selector="TextBox.terminal:pointerover /template/ Border#PART_BorderElement">
            <Setter Property="Background" Value="{StaticResource TerminalBackground}"/>
        </Style>

        <!-- Modal content styles -->
        <Style Selector="Border.modal-content-box">
            <Setter Property="Background" Value="{StaticResource DarkTealGrey}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <!-- Stats label style -->
        <Style Selector="TextBlock.stat-label">
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="{StaticResource MediumGrey}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,0,2"/>
        </Style>

        <Style Selector="TextBlock.stat-value">
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource LightCream}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>

        <!-- Balatro Stat Strip Styles -->
        <Style Selector="Border.balatro-stat-strip">
            <Setter Property="Height" Value="42"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="{StaticResource DarkBorder}"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>

        <Style Selector="Border.strip-label">
            <Setter Property="Background" Value="{StaticResource VeryLightGrey}"/>
            <Setter Property="CornerRadius" Value="4,0,0,4"/>
            <Setter Property="Padding" Value="12,0,12,0"/>
        </Style>

        <Style Selector="Border.strip-value">
            <Setter Property="Background" Value="{StaticResource VeryDarkGrey2}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource LightCream}"/>
            <Setter Property="CornerRadius" Value="0,4,4,0"/>
            <Setter Property="Padding" Value="12,0,12,0"/>
        </Style>

        <Style Selector="TextBlock.strip-label-text">
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="{StaticResource VeryDarkGrey2}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style Selector="TextBlock.strip-value-text">
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="{StaticResource LightCream}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
        </Style>

        <!-- Color variants for different stat types -->
        <Style Selector="Border.strip-label.gold">
            <Setter Property="Background" Value="{StaticResource Gold}"/>
        </Style>

        <Style Selector="Border.strip-label.green">
            <Setter Property="Background" Value="{StaticResource Green}"/>
        </Style>

        <Style Selector="Border.strip-label.cyan">
            <Setter Property="Background" Value="{StaticResource Blue}"/>
        </Style>

        <Style Selector="TextBlock.strip-value-text.gold">
            <Setter Property="Foreground" Value="{StaticResource Gold}"/>
        </Style>

        <Style Selector="TextBlock.strip-value-text.green">
            <Setter Property="Foreground" Value="{StaticResource Green}"/>
        </Style>

        <Style Selector="TextBlock.strip-value-text.cyan">
            <Setter Property="Foreground" Value="{StaticResource Blue}"/>
        </Style>

        <!-- Color-specific border styles -->
        <Style Selector="Border.strip-value.gold">
            <Setter Property="BorderBrush" Value="{StaticResource Gold}"/>
        </Style>

        <Style Selector="Border.strip-value.green">
            <Setter Property="BorderBrush" Value="{StaticResource Green}"/>
        </Style>

        <Style Selector="Border.strip-value.cyan">
            <Setter Property="BorderBrush" Value="{StaticResource Blue}"/>
        </Style>
    </UserControl.Styles>

    <Grid>
        <!-- 3 Column Layout -->
        <Grid Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/> <!-- Left column for parameters -->
                <ColumnDefinition Width="*"/>   <!-- Middle for console -->
                <ColumnDefinition Width="200"/> <!-- Right column for stats -->
            </Grid.ColumnDefinitions>

            <!-- Left Column - Search Parameters -->
            <Border Grid.Column="0"
                    Classes="modal-content-box"
                    Margin="0,0,6,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="0">

                        <!-- Active Filter Display -->
                        <StackPanel Margin="0,0,0,8">
                            <TextBlock Text="Active Filter"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="11"
                                       Foreground="{StaticResource MediumGrey}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,2"/>
                            <TextBlock Text="{Binding LoadedConfig.Name}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="12"
                                       Foreground="{StaticResource Gold}"
                                       HorizontalAlignment="Center"
                                       TextWrapping="Wrap"
                                       TextAlignment="Center"/>
                        </StackPanel>

                        <Rectangle Height="1"
                                   Fill="{StaticResource DarkBorder}"
                                   Margin="0,0,0,8"
                                   HorizontalAlignment="Stretch"/>

                        <!-- Search Mode Spinner -->
                        <controls:SpinnerControl Name="SearchModeSpinner"
                                                Label="Search Mode"
                                                SpinnerType="default"
                                                Value="{Binding SelectedSearchMode}"
                                                Minimum="0"
                                                Maximum="2"
                                                ReadOnly="True"
                                                DisplayValues="{Binding SearchModeDisplayValues}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"
                                                Margin="0,0,0,8"/>

                        <Rectangle Height="1"
                                   Fill="{StaticResource DarkBorder}"
                                   Margin="0,0,0,8"
                                   HorizontalAlignment="Stretch"/>

                        <!-- Deck & Stake (Always Visible) -->
                        <controls:SpinnerControl Name="DeckSpinner"
                                                Label="Deck"
                                                SpinnerType="deck"
                                                Value="{Binding SelectedDeckIndex}"
                                                Minimum="0"
                                                Maximum="14"
                                                ReadOnly="True"
                                                DisplayValues="{Binding DeckDisplayValues}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"
                                                Margin="0,0,0,8"/>

                        <controls:SpinnerControl Name="StakeSpinner"
                                                Label="Stake"
                                                SpinnerType="stake"
                                                Value="{Binding SelectedStakeIndex}"
                                                Minimum="0"
                                                Maximum="7"
                                                ReadOnly="True"
                                                DisplayValues="{Binding StakeDisplayValues}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"
                                                Margin="0,0,0,8"/>

                        <Rectangle Height="1"
                                   Fill="{StaticResource DarkBorder}"
                                   Margin="0,0,0,8"
                                   HorizontalAlignment="Stretch"/>

                        <!-- Mode-Specific Settings -->

                        <!-- SMART Auto Mode Checkbox -->
                        <CheckBox Name="SmartAutoModeCheckBox"
                                  Content="SMART Auto Mode"
                                  IsChecked="{Binding IsSmartAutoMode}"
                                  Foreground="{StaticResource White}"
                                  FontFamily="{StaticResource BalatroFont}"
                                  FontSize="11"
                                  Margin="0,0,0,8"
                                  ToolTip.Tip="Automatically manages threads and resources for optimal performance"/>

                        <!-- Threads (All Seeds, Word List) -->
                        <controls:SpinnerControl Name="ThreadsSpinner"
                                                Label="CPU Threads"
                                                Value="{Binding ThreadCount}"
                                                Minimum="1"
                                                Maximum="{Binding MaxThreadCount}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"
                                                IsVisible="{Binding IsThreadsVisible}"
                                                Margin="0,0,0,8"/>

                        <!-- Seed Input (Single Seed only) -->
                        <StackPanel IsVisible="{Binding IsSeedInputVisible}"
                                    Margin="0,0,0,8">
                            <TextBlock Text="Seed Name"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="11"
                                       Foreground="{StaticResource MediumGrey}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,4"/>
                            <TextBox Name="SeedInputBox"
                                     Text="{Binding SeedInput}"
                                     Watermark="Enter seed..."
                                     MaxLength="8"
                                     FontFamily="{StaticResource BalatroFont}"
                                     FontSize="14"
                                     TextAlignment="Center"
                                     Background="{StaticResource DarkTealGrey}"
                                     BorderBrush="{StaticResource DarkBorder}"
                                     BorderThickness="2"
                                     CornerRadius="4"
                                     Height="36"
                                     VerticalContentAlignment="Center"/>
                        </StackPanel>

                        <!-- WordList Dropdown (Word List only) -->
                        <StackPanel IsVisible="{Binding IsWordListVisible}"
                                    Margin="0,0,0,8">
                            <TextBlock Text="Word List"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="11"
                                       Foreground="{StaticResource MediumGrey}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,4"/>
                            <ComboBox Name="WordListDropdown"
                                      ItemsSource="{Binding AvailableWordLists}"
                                      SelectedIndex="{Binding SelectedWordListIndex}"
                                      HorizontalAlignment="Stretch"
                                      FontFamily="{StaticResource BalatroFont}"
                                      FontSize="12"
                                      Background="{StaticResource DarkTealGrey}"
                                      Foreground="{StaticResource White}"
                                      BorderBrush="{StaticResource DarkBorder}"
                                      BorderThickness="2"
                                      CornerRadius="4"
                                      Padding="8,4"/>
                        </StackPanel>

                        <!-- DB List Dropdown (DB List only) -->
                        <StackPanel IsVisible="{Binding IsDbListVisible}"
                                    Margin="0,0,0,8">
                            <TextBlock Text="DB List"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="11"
                                       Foreground="{StaticResource MediumGrey}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,4"/>
                            <ComboBox Name="DbListDropdown"
                                      ItemsSource="{Binding AvailableDbLists}"
                                      SelectedIndex="{Binding SelectedDbListIndex}"
                                      HorizontalAlignment="Stretch"
                                      FontFamily="{StaticResource BalatroFont}"
                                      FontSize="12"
                                      Background="{StaticResource DarkTealGrey}"
                                      Foreground="{StaticResource White}"
                                      BorderBrush="{StaticResource DarkBorder}"
                                      BorderThickness="2"
                                      CornerRadius="4"
                                      Padding="8,4"/>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Middle Column - Console -->
            <Border Grid.Column="1"
                    Classes="modal-content-box"
                    Margin="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Console - simple scrollable TextBox that allows copy/paste -->
                    <ScrollViewer Grid.Row="0"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Auto">
                        <TextBox Name="ConsoleOutput"
                                 Text="{Binding ConsoleText}"
                                 Classes="terminal"
                                 IsReadOnly="True"
                                 TextWrapping="NoWrap"
                                 AcceptsReturn="True"
                                 CaretBrush="Transparent"
                                 BorderThickness="0"/>
                    </ScrollViewer>

                    <!-- Bottom controls area -->
                    <!-- Single row: Min Score on left, Continue checkbox center, COOK button on right -->
                    <StackPanel Grid.Row="1"
                                Margin="0,12,0,0"
                                Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                Spacing="16"
                                VerticalAlignment="Center">
                            <!-- Min Score Spinner -->
                            <controls:SpinnerControl Name="MinScoreSpinner"
                                                    Label="Min Score"
                                                    SpinnerType="min-score"
                                                    Value="{Binding MinScore}"
                                                    Minimum="-1"
                                                    Maximum="5"
                                                    AllowAuto="True"
                                                    Width="180"
                                                    ShadowDirection="south-east"/>

                            <!-- Continue Checkbox -->
                            <CheckBox Name="ContinueCheckBox"
                                      Content="Continue from last position"
                                      IsChecked="{Binding ContinueFromLast}"
                                      Foreground="{StaticResource White}"
                                      FontFamily="{StaticResource BalatroFont}"
                                      FontSize="11"
                                      IsVisible="{Binding IsContinueVisible}"
                                      VerticalAlignment="Center"
                                      Margin="0,0,16,0"/>

                            <!-- COOK button - Dynamic classes based on state -->
                            <Button Name="CookButton"
                                    Content="{Binding CookButtonText}"
                                    Classes.btn-blue="{Binding !IsSearching}"
                                    Classes.btn-warning="{Binding IsSearching}"
                                    Command="{Binding ToggleSearchCommand}"
                                    FontFamily="{StaticResource BalatroFont}"
                                    FontSize="24"
                                    Height="52"
                                    MinWidth="200"
                                    Margin="0,0,12,0"/>

                            <!-- Edit Filter button - Opens filter designer with current filter -->
                            <Button Name="EditFilterButton"
                                    Content="EDIT FILTER"
                                    Classes="btn-orange"
                                    IsEnabled="{Binding !IsSearching}"
                                    Command="{Binding EditFilterCommand}"
                                    FontFamily="{StaticResource BalatroFont}"
                                    FontSize="18"
                                    Height="52"
                                    MinWidth="160"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Right Column - Stats Panel -->
            <Border Grid.Column="2"
                    Classes="modal-content-box"
                    Margin="6,0,0,0">
                <StackPanel Spacing="0">
                    <TextBlock Text="Search Progress"
                               FontFamily="{StaticResource BalatroFont}"
                               FontSize="14"
                               Foreground="{StaticResource Gold}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,12"/>

                    <!-- Progress % Strip (Gold) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="*,*">
                            <Border Grid.Column="0" Classes="strip-label gold">
                                <TextBlock Text="Progress" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value gold">
                                <TextBlock Text="{Binding ProgressPercent, StringFormat='{}{0:0.00}%'}"
                                           Classes="strip-value-text gold"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Speed Strip (Gold) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="*,*">
                            <Border Grid.Column="0" Classes="strip-label gold">
                                <TextBlock Text="Speed" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value gold">
                                <TextBlock Text="{Binding SearchSpeed}"
                                           Classes="strip-value-text gold"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Threads Strip (Gold) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="*,*">
                            <Border Grid.Column="0" Classes="strip-label gold">
                                <TextBlock Text="Threads" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value gold">
                                <TextBlock Text="{Binding ThreadCount}"
                                           Classes="strip-value-text gold"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Seeds Processed Strip (White) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="*,*">
                            <Border Grid.Column="0" Classes="strip-label">
                                <TextBlock Text="Seeds" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value">
                                <TextBlock Text="{Binding SeedsProcessed}"
                                           Classes="strip-value-text"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Time Elapsed Strip (White) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="*,*">
                            <Border Grid.Column="0" Classes="strip-label">
                                <TextBlock Text="Time" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value">
                                <TextBlock Text="{Binding TimeElapsed}"
                                           Classes="strip-value-text"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- ETA Strip (Cyan) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="*,*">
                            <Border Grid.Column="0" Classes="strip-label cyan">
                                <TextBlock Text="ETA" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value cyan">
                                <TextBlock Text="{Binding EstimatedTimeRemaining}"
                                           Classes="strip-value-text cyan"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Results Found Strip (Green) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="*,*">
                            <Border Grid.Column="0" Classes="strip-label green">
                                <TextBlock Text="Found" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value green">
                                <TextBlock Text="{Binding ResultsCount, StringFormat='{}{0:N0}'}"
                                           Classes="strip-value-text green"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Find Rate Strip (White) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="*,*">
                            <Border Grid.Column="0" Classes="strip-label">
                                <TextBlock Text="Rate" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value">
                                <TextBlock Text="{Binding FindRate}"
                                           Classes="strip-value-text"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Rarity Strip (Gold) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="*,*">
                            <Border Grid.Column="0" Classes="strip-label gold">
                                <TextBlock Text="Rarity" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value gold">
                                <TextBlock Text="{Binding Rarity}"
                                           Classes="strip-value-text gold"/>
                            </Border>
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
