<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels"
             xmlns:controls="using:BalatroSeedOracle.Controls"
             x:Class="BalatroSeedOracle.Views.SearchModalTabs.SearchTab"
             x:DataType="vm:SearchModalViewModel">

    <UserControl.Styles>
        <!-- Big COOK button style -->
        <Style Selector="Button.cook-button">
            <Setter Property="Background" Value="{StaticResource Blue}"/>
            <Setter Property="Foreground" Value="{StaticResource White}"/>
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="36"/>
            <Setter Property="Height" Value="64"/>
            <Setter Property="MinWidth" Value="280"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.cook-button:pointerover">
            <Setter Property="Background" Value="{StaticResource BlueHover}"/>
        </Style>
        <Style Selector="Button.cook-button.stop">
            <Setter Property="Background" Value="{StaticResource Red}"/>
        </Style>
        <Style Selector="Button.cook-button.stop:pointerover">
            <Setter Property="Background" Value="{StaticResource RedHover}"/>
        </Style>

        <!-- Terminal style for console -->
        <Style Selector="TextBox.terminal">
            <Setter Property="Background" Value="{StaticResource TerminalBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource SpecialGreenText}"/>
            <Setter Property="FontFamily" Value="Cascadia Code, Consolas, monospace"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <!-- Keep same background when focused -->
        <Style Selector="TextBox.terminal:focus /template/ Border#PART_BorderElement">
            <Setter Property="Background" Value="{StaticResource TerminalBackground}"/>
        </Style>

        <!-- Modal content styles -->
        <Style Selector="Border.modal-content-box">
            <Setter Property="Background" Value="{StaticResource DarkTealGrey}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <!-- Stats label style -->
        <Style Selector="TextBlock.stat-label">
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="{StaticResource MediumGrey}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,0,2"/>
        </Style>

        <Style Selector="TextBlock.stat-value">
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource LightCream}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>

        <!-- Balatro Stat Strip Styles -->
        <Style Selector="Border.balatro-stat-strip">
            <Setter Property="Height" Value="42"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="#4A5A6A"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
            <Setter Property="BoxShadow" Value="0 2 0 0 #20000000, inset 0 -1 0 0 #30FFFFFF, inset 0 1 2 0 #40000000"/>
        </Style>

        <Style Selector="Border.strip-label">
            <Setter Property="Background" Value="#8FA5B0"/>
            <Setter Property="CornerRadius" Value="4,0,0,4"/>
            <Setter Property="Padding" Value="12,0,12,0"/>
        </Style>

        <Style Selector="Border.strip-value">
            <Setter Property="Background" Value="#1A1D23"/>
            <Setter Property="CornerRadius" Value="0,4,4,0"/>
            <Setter Property="Padding" Value="12,0,12,0"/>
        </Style>

        <Style Selector="TextBlock.strip-label-text">
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#1A1D23"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style Selector="TextBlock.strip-value-text">
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Foreground" Value="{StaticResource LightCream}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
        </Style>

        <!-- Color variants for different stat types -->
        <Style Selector="Border.strip-label.gold">
            <Setter Property="Background" Value="{StaticResource Gold}"/>
        </Style>

        <Style Selector="Border.strip-label.green">
            <Setter Property="Background" Value="{StaticResource Green}"/>
        </Style>

        <Style Selector="Border.strip-label.cyan">
            <Setter Property="Background" Value="#6ECFFF"/>
        </Style>

        <Style Selector="TextBlock.strip-value-text.gold">
            <Setter Property="Foreground" Value="{StaticResource Gold}"/>
        </Style>

        <Style Selector="TextBlock.strip-value-text.green">
            <Setter Property="Foreground" Value="{StaticResource Green}"/>
        </Style>

        <Style Selector="TextBlock.strip-value-text.cyan">
            <Setter Property="Foreground" Value="#6ECFFF"/>
        </Style>
    </UserControl.Styles>

    <Grid>
        <!-- 3 Column Layout -->
        <Grid Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/> <!-- Left column for parameters -->
                <ColumnDefinition Width="*"/>   <!-- Middle for console -->
                <ColumnDefinition Width="200"/> <!-- Right column for stats -->
            </Grid.ColumnDefinitions>

            <!-- Left Column - Search Parameters -->
            <Border Grid.Column="0"
                    Classes="modal-content-box"
                    Margin="0,0,6,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="0">

                        <!-- Active Filter Display -->
                        <StackPanel Margin="0,0,0,8">
                            <TextBlock Text="Active Filter"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="11"
                                       Foreground="{StaticResource MediumGrey}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,2"/>
                            <TextBlock Text="{Binding LoadedConfig.Name, FallbackValue='No filter loaded'}"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="12"
                                       Foreground="{StaticResource Gold}"
                                       HorizontalAlignment="Center"
                                       TextWrapping="Wrap"
                                       TextAlignment="Center"/>
                        </StackPanel>

                        <Rectangle Height="1"
                                   Fill="{StaticResource DarkBorder}"
                                   Margin="0,0,0,8"
                                   HorizontalAlignment="Stretch"/>

                        <!-- Search Mode Spinner -->
                        <controls:SpinnerControl Name="SearchModeSpinner"
                                                Label="Search Mode"
                                                SpinnerType="default"
                                                Value="{Binding SelectedSearchMode}"
                                                Minimum="0"
                                                Maximum="2"
                                                ReadOnly="True"
                                                DisplayValues="{Binding SearchModeDisplayValues}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"
                                                Margin="0,0,0,8"/>

                        <Rectangle Height="1"
                                   Fill="{StaticResource DarkBorder}"
                                   Margin="0,0,0,8"
                                   HorizontalAlignment="Stretch"/>

                        <!-- Deck & Stake (Always Visible) -->
                        <controls:SpinnerControl Name="DeckSpinner"
                                                Label="Deck"
                                                SpinnerType="deck"
                                                Value="{Binding SelectedDeckIndex}"
                                                Minimum="0"
                                                Maximum="14"
                                                ReadOnly="True"
                                                DisplayValues="{Binding DeckDisplayValues}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"
                                                Margin="0,0,0,8"/>

                        <controls:SpinnerControl Name="StakeSpinner"
                                                Label="Stake"
                                                SpinnerType="stake"
                                                Value="{Binding SelectedStakeIndex}"
                                                Minimum="0"
                                                Maximum="7"
                                                ReadOnly="True"
                                                DisplayValues="{Binding StakeDisplayValues}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"
                                                Margin="0,0,0,8"/>

                        <Rectangle Height="1"
                                   Fill="{StaticResource DarkBorder}"
                                   Margin="0,0,0,8"
                                   HorizontalAlignment="Stretch"/>

                        <!-- Mode-Specific Settings -->

                        <!-- Threads (All Seeds, Word List) -->
                        <controls:SpinnerControl Name="ThreadsSpinner"
                                                Label="CPU Threads"
                                                Value="{Binding ThreadCount}"
                                                Minimum="1"
                                                Maximum="{Binding MaxThreadCount}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"
                                                IsVisible="{Binding IsThreadsVisible}"
                                                Margin="0,0,0,8"/>

                        <!-- Batch Size (All Seeds, Word List) -->
                        <controls:SpinnerControl Name="BatchSizeSpinner"
                                                Label="Batch Size (35^n)"
                                                Value="{Binding BatchSize}"
                                                Minimum="0"
                                                Maximum="3"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"
                                                IsVisible="{Binding IsBatchSizeVisible}"
                                                Margin="0,0,0,8"/>

                        <!-- Continue Checkbox (All Seeds only) -->
                        <CheckBox Name="ContinueCheckBox"
                                  Content="Continue from last position"
                                  IsChecked="{Binding ContinueFromLast}"
                                  Foreground="{StaticResource White}"
                                  FontFamily="{StaticResource BalatroFont}"
                                  FontSize="11"
                                  IsVisible="{Binding IsContinueVisible}"
                                  Margin="0,0,0,8"/>

                        <!-- Seed Input (Single Seed only) -->
                        <StackPanel IsVisible="{Binding IsSeedInputVisible}"
                                    Margin="0,0,0,8">
                            <TextBlock Text="Seed Name"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="11"
                                       Foreground="{StaticResource MediumGrey}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,4"/>
                            <TextBox Name="SeedInputBox"
                                     Text="{Binding SeedInput}"
                                     Watermark="Enter seed..."
                                     MaxLength="8"
                                     FontFamily="{StaticResource BalatroFont}"
                                     FontSize="14"
                                     TextAlignment="Center"
                                     Background="{StaticResource DarkTealGrey}"
                                     BorderBrush="{StaticResource DarkBorder}"
                                     BorderThickness="2"
                                     CornerRadius="4"
                                     Height="36"
                                     VerticalContentAlignment="Center"/>
                        </StackPanel>

                        <!-- WordList Dropdown (Word List only) -->
                        <controls:SpinnerControl Name="WordListSpinner"
                                                Label="Word List"
                                                SpinnerType="default"
                                                Value="{Binding SelectedWordListIndex}"
                                                Minimum="0"
                                                Maximum="{Binding WordListMaxIndex}"
                                                ReadOnly="True"
                                                DisplayValues="{Binding AvailableWordLists}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"
                                                IsVisible="{Binding IsWordListVisible}"
                                                Margin="0,0,0,8"/>

                        <Rectangle Height="1"
                                   Fill="{StaticResource DarkBorder}"
                                   Margin="0,0,0,8"
                                   HorizontalAlignment="Stretch"/>

                        <!-- Min Score (Always Visible) -->
                        <controls:SpinnerControl Name="MinScoreSpinner"
                                                Label="Min Score"
                                                SpinnerType="min-score"
                                                Value="{Binding MinScore}"
                                                Minimum="0"
                                                Maximum="5"
                                                AllowAuto="True"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"
                                                Margin="0,0,0,0"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Middle Column - Console -->
            <Border Grid.Column="1"
                    Classes="modal-content-box"
                    Margin="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBox Grid.Row="0"
                             Name="ConsoleOutput"
                             Classes="terminal"
                             IsReadOnly="True"
                             AcceptsReturn="True"
                             TextWrapping="NoWrap"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             ScrollViewer.HorizontalScrollBarVisibility="Auto"
                             Text="{Binding ConsoleText}"/>

                    <!-- Buttons row -->
                    <StackPanel Grid.Row="1"
                                Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                Spacing="12"
                                Margin="0,12,0,0">
                        <!-- COOK button -->
                        <Button Name="CookButton"
                                Content="{Binding CookButtonText}"
                                Classes="cook-button"
                                Classes.stop="{Binding IsSearching}"
                                Command="{Binding ToggleSearchCommand}"
                                FontFamily="{StaticResource BalatroFont}"
                                FontSize="26"
                                Height="56"
                                MinWidth="240"/>

                        <!-- Clear Console button -->
                        <Button Content="Clear Console"
                                Command="{Binding ClearConsoleCommand}"
                                FontFamily="{StaticResource BalatroFont}"
                                FontSize="14"
                                Height="40"
                                MinWidth="120"
                                Background="{StaticResource DarkGrey}"
                                Foreground="{StaticResource White}"
                                CornerRadius="6"
                                Cursor="Hand"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Right Column - Stats Panel -->
            <Border Grid.Column="2"
                    Classes="modal-content-box"
                    Margin="6,0,0,0">
                <StackPanel Spacing="0">
                    <TextBlock Text="Search Progress"
                               FontFamily="{StaticResource BalatroFont}"
                               FontSize="14"
                               Foreground="{StaticResource Gold}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,12"/>

                    <!-- Progress % Strip (Gold) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="Auto,*">
                            <Border Grid.Column="0" Classes="strip-label gold">
                                <TextBlock Text="Progress" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value">
                                <TextBlock Text="{Binding ProgressPercent, StringFormat='{}{0:0.00}%', FallbackValue='0.00%'}"
                                           Classes="strip-value-text gold"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Speed Strip (Gold) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="Auto,*">
                            <Border Grid.Column="0" Classes="strip-label gold">
                                <TextBlock Text="Speed" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value">
                                <TextBlock Text="{Binding SearchSpeed, FallbackValue='0 seeds/s'}"
                                           Classes="strip-value-text gold"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Seeds Processed Strip (White) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="Auto,*">
                            <Border Grid.Column="0" Classes="strip-label">
                                <TextBlock Text="Seeds" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value">
                                <TextBlock Text="{Binding SeedsProcessed, StringFormat='{}{0:N0}', FallbackValue='0'}"
                                           Classes="strip-value-text"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Time Elapsed Strip (White) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="Auto,*">
                            <Border Grid.Column="0" Classes="strip-label">
                                <TextBlock Text="Time" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value">
                                <TextBlock Text="{Binding TimeElapsed, FallbackValue='00:00:00'}"
                                           Classes="strip-value-text"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- ETA Strip (Cyan) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="Auto,*">
                            <Border Grid.Column="0" Classes="strip-label cyan">
                                <TextBlock Text="ETA" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value">
                                <TextBlock Text="{Binding EstimatedTimeRemaining, FallbackValue='--:--:--'}"
                                           Classes="strip-value-text cyan"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Results Found Strip (Green) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="Auto,*">
                            <Border Grid.Column="0" Classes="strip-label green">
                                <TextBlock Text="Found" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value">
                                <TextBlock Text="{Binding ResultsCount, StringFormat='{}{0:N0}', FallbackValue='0'}"
                                           Classes="strip-value-text green"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Find Rate Strip (White) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="Auto,*">
                            <Border Grid.Column="0" Classes="strip-label">
                                <TextBlock Text="Rate" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value">
                                <TextBlock Text="{Binding FindRate, FallbackValue='0.00%'}"
                                           Classes="strip-value-text"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Rarity Strip (Gold) -->
                    <Border Classes="balatro-stat-strip">
                        <Grid ColumnDefinitions="Auto,*">
                            <Border Grid.Column="0" Classes="strip-label gold">
                                <TextBlock Text="Rarity" Classes="strip-label-text"/>
                            </Border>
                            <Border Grid.Column="1" Classes="strip-value">
                                <TextBlock Text="{Binding Rarity, FallbackValue='--'}"
                                           Classes="strip-value-text gold"/>
                            </Border>
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
