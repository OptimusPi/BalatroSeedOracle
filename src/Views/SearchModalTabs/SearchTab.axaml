<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels"
             xmlns:controls="using:BalatroSeedOracle.Controls"
             x:Class="BalatroSeedOracle.Views.SearchModalTabs.SearchTab"
             x:DataType="vm:SearchModalViewModel">

    <UserControl.Styles>
        <!-- Big COOK button style -->
        <Style Selector="Button.cook-button">
            <Setter Property="Background" Value="{StaticResource Blue}"/>
            <Setter Property="Foreground" Value="{StaticResource White}"/>
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="36"/>
            <Setter Property="Height" Value="64"/>
            <Setter Property="MinWidth" Value="280"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.cook-button:pointerover">
            <Setter Property="Background" Value="{StaticResource BlueHover}"/>
        </Style>
        <Style Selector="Button.cook-button.stop">
            <Setter Property="Background" Value="{StaticResource Red}"/>
        </Style>
        <Style Selector="Button.cook-button.stop:pointerover">
            <Setter Property="Background" Value="{StaticResource RedHover}"/>
        </Style>

        <!-- Terminal style for console -->
        <Style Selector="TextBox.terminal">
            <Setter Property="Background" Value="{StaticResource TerminalBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource SpecialGreenText}"/>
            <Setter Property="FontFamily" Value="Cascadia Code, Consolas, monospace"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <!-- Modal content styles -->
        <Style Selector="Border.modal-content-box">
            <Setter Property="Background" Value="{StaticResource DarkTealGrey}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <!-- Stats label style -->
        <Style Selector="TextBlock.stat-label">
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="{StaticResource MediumGrey}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,0,2"/>
        </Style>

        <Style Selector="TextBlock.stat-value">
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource LightCream}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>
    </UserControl.Styles>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Current Filter Display -->
        <Border Grid.Row="0"
                Classes="modal-content-box"
                Margin="10,10,10,4"
                Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="Active Filter:"
                           FontFamily="{StaticResource BalatroFont}"
                           FontSize="14"
                           Foreground="{StaticResource MediumGrey}"
                           VerticalAlignment="Center"
                           Margin="0,0,10,0"/>

                <TextBlock Grid.Column="1"
                           Text="{Binding LoadedConfig.Name, FallbackValue='No filter loaded'}"
                           FontFamily="{StaticResource BalatroFont}"
                           FontSize="14"
                           Foreground="{StaticResource LightCream}"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- 3 Column Layout -->
        <Grid Grid.Row="1" Margin="10,0,10,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/> <!-- Left column for parameters -->
                <ColumnDefinition Width="*"/>   <!-- Middle for console -->
                <ColumnDefinition Width="200"/> <!-- Right column for stats -->
            </Grid.ColumnDefinitions>

            <!-- Left Column - Search Parameters -->
            <Border Grid.Column="0"
                    Classes="modal-content-box"
                    Margin="0,0,6,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Spacing="10">
                        <!-- Deck Spinner -->
                        <controls:SpinnerControl Name="DeckSpinner"
                                                Label="Deck"
                                                SpinnerType="deck"
                                                Value="{Binding SelectedDeckIndex}"
                                                Minimum="0"
                                                Maximum="14"
                                                ReadOnly="True"
                                                DisplayValues="{Binding DeckDisplayValues}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"/>

                        <!-- Stake Spinner -->
                        <controls:SpinnerControl Name="StakeSpinner"
                                                Label="Stake"
                                                SpinnerType="stake"
                                                Value="{Binding SelectedStakeIndex}"
                                                Minimum="0"
                                                Maximum="7"
                                                ReadOnly="True"
                                                DisplayValues="{Binding StakeDisplayValues}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"/>

                        <!-- Threads -->
                        <controls:SpinnerControl Name="ThreadsSpinner"
                                                Label="CPU Threads"
                                                Value="{Binding ThreadCount}"
                                                Minimum="1"
                                                Maximum="{Binding MaxThreadCount}"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"/>

                        <!-- Batch Size -->
                        <controls:SpinnerControl Name="BatchSizeSpinner"
                                                Label="Batch Size (35^n)"
                                                Value="{Binding BatchSize}"
                                                Minimum="0"
                                                Maximum="3"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"/>

                        <!-- Min Score -->
                        <controls:SpinnerControl Name="MinScoreSpinner"
                                                Label="Min Score"
                                                SpinnerType="min-score"
                                                Value="{Binding MinScore}"
                                                Minimum="0"
                                                Maximum="5"
                                                AllowAuto="True"
                                                HorizontalAlignment="Stretch"
                                                ShadowDirection="south-east"/>

                        <!-- Debug seed input -->
                        <StackPanel Orientation="Vertical" Margin="0,10,0,5">
                            <TextBlock Text="Debug Seed:"
                                       FontFamily="{StaticResource BalatroFont}"
                                       FontSize="11"
                                       Foreground="{StaticResource MediumGrey}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,4"/>
                            <TextBox Name="DebugSeedInput"
                                     Text="{Binding DebugSeed}"
                                     Watermark="Enter seed..."
                                     MaxLength="8"
                                     Width="140"
                                     Height="32"
                                     HorizontalAlignment="Center"
                                     FontFamily="{StaticResource BalatroFont}"
                                     FontSize="14"
                                     TextAlignment="Center"
                                     Background="{StaticResource DarkTealGrey}"
                                     BorderBrush="{StaticResource DarkBorder}"
                                     BorderThickness="1"
                                     IsEnabled="{Binding IsDebugMode}"
                                     CornerRadius="4"/>
                        </StackPanel>

                        <!-- Debug checkbox -->
                        <CheckBox Name="DebugCheckBox"
                                  Content="Debug Mode"
                                  IsChecked="{Binding IsDebugMode}"
                                  Foreground="White"
                                  HorizontalAlignment="Center"
                                  FontFamily="{StaticResource BalatroFont}"
                                  FontSize="12"
                                  Margin="0,5,0,10"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Middle Column - Console -->
            <Border Grid.Column="1"
                    Classes="modal-content-box"
                    Margin="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBox Grid.Row="0"
                             Name="ConsoleOutput"
                             Classes="terminal"
                             IsReadOnly="True"
                             AcceptsReturn="True"
                             TextWrapping="NoWrap"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             ScrollViewer.HorizontalScrollBarVisibility="Auto"
                             Text="{Binding ConsoleText}"/>

                    <!-- JSON Validation Status -->
                    <Border Grid.Row="1"
                            Background="{StaticResource ContainerDarkPrecise}"
                            BorderBrush="{StaticResource ModalBorder}"
                            BorderThickness="0,1,0,0"
                            Padding="8,4"
                            Margin="0,4,0,0">
                        <TextBlock Name="JsonValidationStatus"
                                   Text="{Binding JsonValidationStatus}"
                                   FontFamily="{StaticResource BalatroFont}"
                                   FontSize="12"
                                   Foreground="{Binding JsonValidationColor}"
                                   HorizontalAlignment="Left"/>
                    </Border>

                    <!-- Buttons row -->
                    <StackPanel Grid.Row="2"
                                Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                Spacing="12"
                                Margin="0,12,0,0">
                        <!-- COOK button -->
                        <Button Name="CookButton"
                                Content="{Binding CookButtonText}"
                                Classes="cook-button"
                                Classes.stop="{Binding IsSearching}"
                                Command="{Binding ToggleSearchCommand}"
                                FontFamily="{StaticResource BalatroFont}"
                                FontSize="26"
                                Height="56"
                                MinWidth="240"/>

                        <!-- Clear Console button -->
                        <Button Content="Clear Console"
                                Command="{Binding ClearConsoleCommand}"
                                FontFamily="{StaticResource BalatroFont}"
                                FontSize="14"
                                Height="40"
                                MinWidth="120"
                                Background="{StaticResource DarkGrey}"
                                Foreground="{StaticResource White}"
                                CornerRadius="6"
                                Cursor="Hand"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Right Column - Stats Panel -->
            <Border Grid.Column="2"
                    Classes="modal-content-box"
                    Margin="6,0,0,0">
                <StackPanel Spacing="8">
                    <TextBlock Text="Search Progress"
                               FontFamily="{StaticResource BalatroFont}"
                               FontSize="14"
                               Foreground="{StaticResource Gold}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,8"/>

                    <!-- Progress % -->
                    <StackPanel>
                        <TextBlock Text="Progress %" Classes="stat-label"/>
                        <TextBlock Text="{Binding ProgressPercent, StringFormat='{}{0:0.00}%'}" Classes="stat-value"/>
                    </StackPanel>

                    <!-- Speed -->
                    <StackPanel>
                        <TextBlock Text="Speed" Classes="stat-label"/>
                        <TextBlock Text="{Binding SearchSpeed, FallbackValue='0 seeds/s'}" Classes="stat-value"/>
                    </StackPanel>

                    <!-- Current Batch -->
                    <StackPanel>
                        <TextBlock Text="Current Batch" Classes="stat-label"/>
                        <TextBlock Text="{Binding CurrentBatch, FallbackValue='0'}" Classes="stat-value"/>
                    </StackPanel>

                    <!-- Max Batch -->
                    <StackPanel>
                        <TextBlock Text="Max Batch" Classes="stat-label"/>
                        <TextBlock Text="{Binding MaxBatch, FallbackValue='0'}" Classes="stat-value"/>
                    </StackPanel>

                    <!-- Seeds Processed -->
                    <StackPanel>
                        <TextBlock Text="Seeds" Classes="stat-label"/>
                        <TextBlock Text="{Binding SeedsProcessed, FallbackValue='0'}" Classes="stat-value"/>
                    </StackPanel>

                    <!-- Time Elapsed -->
                    <StackPanel>
                        <TextBlock Text="Time" Classes="stat-label"/>
                        <TextBlock Text="{Binding TimeElapsed, FallbackValue='00:00:00'}" Classes="stat-value"/>
                    </StackPanel>

                    <!-- ETA -->
                    <StackPanel>
                        <TextBlock Text="ETA" Classes="stat-label"/>
                        <TextBlock Text="{Binding EstimatedTimeRemaining, FallbackValue='--:--:--'}" Classes="stat-value"/>
                    </StackPanel>

                    <!-- Results Found -->
                    <StackPanel>
                        <TextBlock Text="Found" Classes="stat-label"/>
                        <TextBlock Text="{Binding ResultsCount, FallbackValue='0'}" Classes="stat-value" Foreground="{StaticResource Green}"/>
                    </StackPanel>

                    <!-- Find Rate -->
                    <StackPanel>
                        <TextBlock Text="Rate" Classes="stat-label"/>
                        <TextBlock Text="{Binding FindRate, FallbackValue='0.00%'}" Classes="stat-value"/>
                    </StackPanel>

                    <!-- Rarity -->
                    <StackPanel>
                        <TextBlock Text="Rarity" Classes="stat-label"/>
                        <TextBlock Text="{Binding Rarity, FallbackValue='1 in 0'}" Classes="stat-value"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
