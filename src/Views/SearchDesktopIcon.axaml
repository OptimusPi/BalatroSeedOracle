<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels"
             xmlns:comp="using:BalatroSeedOracle.Components"
             x:Class="BalatroSeedOracle.Views.SearchDesktopIcon"
             x:DataType="vm:SearchDesktopIconViewModel"
             x:CompileBindings="True">

    <!-- Use shared BaseWidget for shortcuts -->
    <comp:BaseWidget ContextRequested="OnContextRequested">
        <!-- Expanded content shown when widget is opened -->
        <StackPanel Spacing="10">
            <!-- Header info -->
            <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="🔍" FontSize="16" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding FilterName}"
                           FontFamily="{StaticResource BalatroFont}"
                           FontSize="14"
                           
                           Foreground="{StaticResource White}"
                           VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Progress Bar with Percentage -->
            <Grid>
                <ProgressBar Value="{Binding SearchProgress}"
                             Maximum="100"
                             Height="6"
                             Background="{StaticResource DarkBackground}"
                             Foreground="{StaticResource Green}"
                             BorderThickness="0"
                             CornerRadius="3"/>
                <TextBlock Text="{Binding ProgressText}"
                           FontFamily="{StaticResource BalatroFont}"
                           FontSize="11"
                           Foreground="{StaticResource White}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Margin="0,-1,0,0"/>
            </Grid>

            <!-- Actions -->
            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Content="Open Search"
                        Command="{Binding ViewResultsCommand}"/>
                <Button Content="Pause"
                        Command="{Binding PauseSearchCommand}"
                        IsEnabled="{Binding IsSearching}"/>
                <Button Content="Resume"
                        Command="{Binding ResumeSearchCommand}"
                        IsEnabled="{Binding !IsSearching}"/>
                <Button Content="Stop"
                        Command="{Binding StopSearchCommand}"/>
                <Button Content="Remove Icon"
                        Command="{Binding DeleteIconCommand}"/>
            </StackPanel>

            <!-- Preview: state icon or filter preview -->
            <Border Background="{StaticResource ModalGrey}" CornerRadius="8" Padding="10">
                <Grid>
                    <Image Source="{Binding StateIcon}"
                           IsVisible="{Binding ShowStateIcon}"
                           Width="64" Height="64" Stretch="Uniform"
                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    <ContentPresenter Content="{Binding FilterPreview}"
                                      IsVisible="{Binding !ShowStateIcon}"
                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Grid>
            </Border>
        </StackPanel>
    </comp:BaseWidget>
</UserControl>