<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels"
             xmlns:components="using:BalatroSeedOracle.Components"
             xmlns:controls="using:BalatroSeedOracle.Controls"
             x:Class="BalatroSeedOracle.Views.Modals.SearchModal"
             x:DataType="vm:SearchModalViewModel">

    <UserControl.Resources>
        <ResourceDictionary>
            <!-- Tab content templates would go here -->
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header with Maximize Button and Title -->
        <Border Grid.Row="0"
                Background="{StaticResource ContainerDarkPrecise}"
                BorderBrush="{StaticResource ModalBorder}"
                BorderThickness="0,0,0,2"
                Padding="15,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Search Icon -->
                <TextBlock Grid.Column="0"
                           Text="ðŸ”"
                           FontSize="24"
                           VerticalAlignment="Center"
                           Margin="0,0,10,0"/>
                
                <!-- Title and Status -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="BALATRO SEED ORACLE"
                               FontFamily="{StaticResource BalatroFont}"
                               FontSize="20"
                               FontWeight="Bold"
                               Foreground="{StaticResource Gold}"/>
                    <TextBlock Text="{Binding SearchStatus}"
                               FontSize="12"
                               Foreground="#FFD700"
                               Opacity="0.8"/>
                </StackPanel>
                
                <!-- Controls -->
                <StackPanel Grid.Column="2" 
                            Orientation="Horizontal" 
                            Spacing="10"
                            VerticalAlignment="Center">
                    
                    <!-- VibeOut Button -->
                    <Button Content="ðŸŽµ VIBE OUT"
                            Command="{Binding EnterVibeOutModeCommand}"
                            Classes="btn-purple"
                            Padding="12,6"
                            FontFamily="{StaticResource BalatroFont}"
                            FontSize="12"
                            CornerRadius="5"/>
                    
                    <!-- Maximize Button -->
                    <Button Name="MaximizeButton"
                            Content="â›¶"
                            Background="Transparent"
                            Foreground="{StaticResource Gold}"
                            BorderThickness="0"
                            Padding="8"
                            FontSize="16"
                            Click="MaximizeButton_Click"
                            ToolTip.Tip="Maximize Window">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="{StaticResource SemiTransparentBlack}"/>
                            </Style>
                        </Button.Styles>
                    </Button>
                    
                    <!-- Close Button -->
                    <Button Content="âœ•"
                            Background="Transparent"
                            Foreground="#FF4444"
                            BorderThickness="0"
                            Padding="8"
                            FontSize="16"
                            Command="{Binding CloseCommand}"
                            ToolTip.Tip="Close Search Modal">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="#22FF4444"/>
                            </Style>
                        </Button.Styles>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- ENHANCED BALATRO TABCONTROL WITH NEW COMPONENTS -->
        <TabControl Grid.Row="1"
                    SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}"
                    ItemsSource="{Binding TabItems}"
                    Classes="balatro-tabs">
            
            <!-- Tab header template - displays the Header property -->
            <TabControl.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding Header}" />
                </DataTemplate>
            </TabControl.ItemTemplate>
            
            <!-- Tab content template - displays the Content property -->
            <TabControl.ContentTemplate>
                <DataTemplate>
                    <ContentControl Content="{Binding Content}"/>
                </DataTemplate>
            </TabControl.ContentTemplate>
        </TabControl>
        
        <!-- Search Progress Overlay (when searching) -->
        <Border Grid.Row="1"
                Background="#88000000"
                IsVisible="{Binding IsSearching}"
                VerticalAlignment="Bottom"
                HorizontalAlignment="Stretch"
                Height="80">
            <Grid Margin="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Spacing="8">
                    <!-- Progress Bar -->
                    <ProgressBar Value="{Binding SearchProgress}"
                                 Maximum="100"
                                 Height="20"
                                 Background="{StaticResource DarkBackground}"
                                 Foreground="{StaticResource Green}"/>
                    
                    <!-- Progress Text -->
                    <TextBlock Text="{Binding ProgressText}"
                               Foreground="#FFD700"
                               FontSize="14"
                               HorizontalAlignment="Center"/>
                </StackPanel>
                
                <!-- Stop Button -->
                <Button Grid.Column="1"
                        Content="â¹ï¸ STOP"
                        Command="{Binding StopSearchCommand}"
                        Background="#FF4444"
                        Foreground="White"
                        Padding="15,10"
                        FontSize="14"
                        VerticalAlignment="Center"
                        Margin="20,0,0,0"/>
            </Grid>
        </Border>
    </Grid>

</UserControl>
