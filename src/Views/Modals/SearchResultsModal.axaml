<views:StandardModal xmlns="https://github.com/avaloniaui"
                     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                     xmlns:views="using:Oracle.Views.Modals"
                     x:Class="Oracle.Views.Modals.SearchResultsModal"
                     Width="1400"
                     Height="800">
    
    <views:StandardModal.Styles>
        <!-- DataGrid styling to match Balatro theme -->
        <Style Selector="DataGrid">
            <Setter Property="Background" Value="{StaticResource VeryDarkBackground}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DarkBorder}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="{StaticResource GridLineGrey}"/>
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
        
        <!-- Header styling -->
        <Style Selector="DataGridColumnHeader">
            <Setter Property="Background" Value="{StaticResource ItemConfigMediumBg}"/>
            <Setter Property="Foreground" Value="{StaticResource VeryLightGrey}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DarkBorder}"/>
            <Setter Property="BorderThickness" Value="0,0,1,2"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="16"/>
        </Style>
        
        <!-- Row styling -->
        <Style Selector="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="MinHeight" Value="36"/>
        </Style>
        
        <Style Selector="DataGridRow:nth-child(2n)">
            <Setter Property="Background" Value="{StaticResource DarkBackground}"/>
        </Style>
        
        <Style Selector="DataGridRow:pointerover /template/ Rectangle#BackgroundRectangle">
            <Setter Property="Fill" Value="{StaticResource ItemConfigMediumBg}"/>
            <Setter Property="Opacity" Value="0.5"/>
        </Style>
        
        <Style Selector="DataGridRow:selected /template/ Rectangle#BackgroundRectangle">
            <Setter Property="Fill" Value="{StaticResource ToggleBlue}"/>
            <Setter Property="Opacity" Value="0.3"/>
        </Style>
        
        <!-- Cell styling -->
        <Style Selector="DataGridCell">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
        
        <!-- Score color coding -->
        <Style Selector="TextBlock.score-high">
            <Setter Property="Foreground" Value="{StaticResource AccentGreen}"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
        
        <Style Selector="TextBlock.score-medium">
            <Setter Property="Foreground" Value="{StaticResource PaleOrange}"/>
        </Style>
        
        <Style Selector="TextBlock.score-low">
            <Setter Property="Foreground" Value="{StaticResource ToggleRed}"/>
        </Style>
        
        <!-- Quick filter styles -->
        <Style Selector="TextBox#QuickFilterBox">
            <Setter Property="Background" Value="{StaticResource VeryDarkBackground}"/>
            <Setter Property="BorderBrush" Value="{StaticResource GridLineGrey}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        
        <Style Selector="TextBox#QuickFilterBox:focus">
            <Setter Property="BorderBrush" Value="{StaticResource ToggleBlue}"/>
        </Style>
        
        <!-- Toolbar button styling -->
        <Style Selector="Button.toolbar-button">
            <Setter Property="Background" Value="{StaticResource ItemConfigMediumBg}"/>
            <Setter Property="Foreground" Value="{StaticResource VeryLightGrey}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DarkBorder}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
        </Style>
        
        <Style Selector="Button.toolbar-button:pointerover">
            <Setter Property="Background" Value="{StaticResource SearchHighlight}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ToggleBlue}"/>
        </Style>
        
        <!-- Stats styling -->
        <Style Selector="TextBlock.stat-label">
            <Setter Property="Foreground" Value="{StaticResource LightGrey}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Margin" Value="0,0,4,0"/>
        </Style>
        
        <Style Selector="TextBlock.stat-value">
            <Setter Property="Foreground" Value="{StaticResource VeryLightGrey}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
    </views:StandardModal.Styles>
    
    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Toolbar -->
        <Border Grid.Row="0" 
                Background="{StaticResource VeryDarkBackground}" 
                BorderBrush="{StaticResource GridLineGrey}" 
                BorderThickness="0,0,0,1"
                Padding="12,8">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Left side - Info -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16">
                    <TextBlock Classes="stat-label" Text="Filter:" VerticalAlignment="Center"/>
                    <TextBlock Name="FilterNameText" 
                              Classes="stat-value" 
                              Text="Loading..."
                              VerticalAlignment="Center"/>
                    
                    <Border Width="1" Background="{StaticResource GridLineGrey}" Margin="8,0"/>
                    
                    <TextBlock Classes="stat-label" Text="Results:" VerticalAlignment="Center"/>
                    <TextBlock Name="ResultCountText" 
                              Classes="stat-value" 
                              Text="0"
                              VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Right side - Actions -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4">
                    <Button Name="LoadHistoryButton" 
                           Classes="toolbar-button"
                           Content="Load History"
                           IsVisible="False"/>
                    
                    <Button Name="ExportCsvButton" 
                           Classes="toolbar-button"
                           Content="Export CSV"/>
                    
                    <Button Name="CopyAllButton" 
                           Classes="toolbar-button"
                           Content="Copy All Seeds"/>
                    
                    <Button Name="RefreshButton" 
                           Classes="toolbar-button"
                           Content="Refresh"
                           IsVisible="False"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Results DataGrid -->
        <Border Grid.Row="1" 
                Background="{StaticResource DarkBackground}"
                BorderBrush="{StaticResource GridLineGrey}"
                BorderThickness="0"
                Margin="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Quick Filter Bar -->
                <Border Grid.Row="0" 
                        Background="{StaticResource DarkBackground2}" 
                        Padding="8"
                        IsVisible="{Binding ShowQuickFilter}">
                    <Grid ColumnDefinitions="Auto,200,Auto,Auto,Auto,*">
                        <TextBlock Grid.Column="0" 
                                  Text="Filter:" 
                                  VerticalAlignment="Center"
                                  Margin="0,0,8,0"
                                  Foreground="{StaticResource LightGrey}"/>
                        
                        <TextBox Grid.Column="1" 
                                Name="QuickFilterBox"
                                Watermark="Type to filter..."
                                Margin="0,0,8,0"/>
                        
                        <Button Grid.Column="2" 
                               Name="ClearFilterButton"
                               Content="Clear"
                               Padding="8,4"
                               Margin="0,0,8,0"/>
                        
                        <Separator Grid.Column="3" 
                                  Width="1" 
                                  Background="{StaticResource GridLineGrey}"
                                  Margin="8,0"/>
                        
                        <CheckBox Grid.Column="4" 
                                 Name="HighScoreOnlyCheck"
                                 Content="High Scores Only (â‰¥100)"
                                 VerticalAlignment="Center"/>
                    </Grid>
                </Border>
                
                <DataGrid Grid.Row="1"
                         Name="ResultsGrid"
                         CanUserResizeColumns="True"
                         CanUserSortColumns="True"
                         CanUserReorderColumns="True"
                         GridLinesVisibility="Horizontal"
                         HeadersVisibility="Column"
                         SelectionMode="Extended"
                         IsReadOnly="True"
                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Seed" 
                                           Width="180"
                                           CanUserSort="True"
                                           SortMemberPath="Seed">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,Auto">
                                    <TextBlock Grid.Column="0"
                                              Text="{Binding Seed}"
                                              FontFamily="{StaticResource MonospaceFont}"
                                              FontSize="14"
                                              VerticalAlignment="Center"/>
                                    <Button Grid.Column="1" 
                                           Content="ðŸ“‹"
                                           ToolTip.Tip="Copy seed"
                                           Background="Transparent"
                                           BorderThickness="0"
                                           Padding="4,2"
                                           Margin="4,0,0,0"
                                           FontSize="12"
                                           Opacity="0.7"
                                           Click="OnCopySeedClick"
                                           Tag="{Binding Seed}">
                                        <Button.Styles>
                                            <Style Selector="Button:pointerover">
                                                <Setter Property="Opacity" Value="1"/>
                                                <Setter Property="Background" Value="{StaticResource GridLineGrey}"/>
                                            </Style>
                                        </Button.Styles>
                                    </Button>
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <DataGridTemplateColumn Header="Score" 
                                           Width="120"
                                           CanUserSort="True"
                                           SortMemberPath="Score">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="4" 
                                       Padding="6,2"
                                       HorizontalAlignment="Right"
                                       Margin="0,2,8,2">
                                    <Border.Background>
                                        <SolidColorBrush Color="{Binding ScoreBackgroundColor}" Opacity="0.2"/>
                                    </Border.Background>
                                    <TextBlock Text="{Binding FormattedScore}"
                                              FontWeight="Bold"
                                              Foreground="{Binding ScoreForeground}"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <DataGridTemplateColumn Header="Antes" 
                                           Width="100"
                                           CanUserSort="True"
                                           SortMemberPath="Antes">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource DarkBackground2}" 
                                       CornerRadius="4" 
                                       Padding="6,2"
                                       HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Antes}"
                                              HorizontalAlignment="Center"
                                              FontWeight="Medium"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <DataGridTemplateColumn Header="Items Found" 
                                           Width="*"
                                           MinWidth="200">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ItemsControl ItemsSource="{Binding FoundItems}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel Orientation="Horizontal"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border ToolTip.Tip="{Binding Tooltip}"
                                                   Margin="2"
                                                   CornerRadius="4"
                                                   Background="{StaticResource DarkBackground2}"
                                                   BorderBrush="{StaticResource GridLineGrey}"
                                                   BorderThickness="1"
                                                   Padding="2">
                                                <Grid>
                                                    <Image Source="{Binding Icon}"
                                                          Width="32"
                                                          Height="32"/>
                                                    <!-- Ante indicator -->
                                                    <Border CornerRadius="6"
                                                           Background="{StaticResource PureBlack}"
                                                           Padding="2,0"
                                                           HorizontalAlignment="Right"
                                                           VerticalAlignment="Bottom"
                                                           Margin="0,0,-2,-2"
                                                           IsVisible="{Binding ShowAnte}">
                                                        <TextBlock Text="{Binding Ante}"
                                                                  FontSize="9"
                                                                  FontWeight="Bold"
                                                                  Foreground="{StaticResource White}"/>
                                                    </Border>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <DataGridTextColumn Header="Timestamp" 
                                       Binding="{Binding Timestamp, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" 
                                       Width="150"
                                       IsVisible="{Binding IsHistoricalView}"/>
                </DataGrid.Columns>
            </DataGrid>
            </Grid>
        </Border>
        
        <!-- Footer Stats -->
        <Border Grid.Row="2" 
                Background="{StaticResource VeryDarkBackground}" 
                BorderBrush="{StaticResource GridLineGrey}" 
                BorderThickness="0,1,0,0"
                Padding="12,8">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="24">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Classes="stat-label" Text="Highest Score:"/>
                        <TextBlock Name="HighestScoreText" 
                                  Classes="stat-value score-high" 
                                  Text="0"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Classes="stat-label" Text="Average Score:"/>
                        <TextBlock Name="AverageScoreText" 
                                  Classes="stat-value" 
                                  Text="0"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" Name="SearchTimePanel" IsVisible="False">
                        <TextBlock Classes="stat-label" Text="Search Time:"/>
                        <TextBlock Name="SearchTimeText" 
                                  Classes="stat-value" 
                                  Text="0s"/>
                    </StackPanel>
                </StackPanel>
                
                <TextBlock Grid.Column="1" 
                          Classes="stat-label"
                          Text="Double-click a row to copy seed â€¢ Ctrl+C to copy selected"
                          VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</views:StandardModal>