<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BalatroSeedOracle.ViewModels"
             xmlns:components="using:BalatroSeedOracle.Components"
             x:Class="BalatroSeedOracle.Views.Modals.FilterSelectionModal"
             x:DataType="vm:FilterSelectionModalViewModel">

    <!-- Full screen modal with Balatro-style overlay -->
    <Grid HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch">
        <!-- Overlay background -->
        <Border x:Name="OverlayBackground"
                Background="{StaticResource SemiTransparentBlack}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                IsHitTestVisible="False" />

        <!-- Modal positioning grid -->
        <Grid x:Name="ModalContainer">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="45"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="45"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="35"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="35"/>
            </Grid.RowDefinitions>

            <!-- Main modal container -->
            <Border x:Name="ModalBorder"
                    Grid.Column="1" Grid.Row="1"
                    Background="{StaticResource ModalGrey}"
                    CornerRadius="20"
                    BorderBrush="{StaticResource ModalBorder}"
                    BorderThickness="4"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    MinWidth="600"
                    MinHeight="400"
                    MaxWidth="1400"
                    MaxHeight="900"
                    BoxShadow="{StaticResource StandardModalShadow}"
                    ClipToBounds="False"
                    Padding="4,4,4,0">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>    <!-- Content -->
                        <RowDefinition Height="60"/>   <!-- Footer fixed height -->
                    </Grid.RowDefinitions>

                    <!-- Content area with 2-column layout -->
                    <Grid Grid.Row="0" Margin="20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="250"/>  <!-- Left: Filter List -->
                            <ColumnDefinition Width="20"/>   <!-- Spacer -->
                            <ColumnDefinition Width="*"/>    <!-- Right: Details Panel -->
                        </Grid.ColumnDefinitions>

                        <!-- LEFT SIDE: Filter List (inline implementation) -->
                        <Border Grid.Column="0"
                                Background="{StaticResource DarkBackground}"
                                BorderThickness="0"
                                CornerRadius="8"
                                Padding="20">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>    <!-- Filter List -->
                                    <RowDefinition Height="Auto"/> <!-- Pagination -->
                                </Grid.RowDefinitions>

                                <!-- Filter List with Selection Triangle -->
                                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                                    <Grid>
                                        <!-- Triangle indicator for selected item -->
                                        <Canvas ClipToBounds="False" IsHitTestVisible="False" Panel.ZIndex="2">
                                            <Polygon Points="15,0 0,10 15,20"
                                                     Classes="balatro-triangle balatro-bounce-horizontal"
                                                     Canvas.Left="0"
                                                     Canvas.Top="{Binding FilterList.SelectedItemTriangleY}"
                                                     IsVisible="{Binding FilterList.HasSelectedFilter}"/>
                                        </Canvas>

                                        <!-- Filter List -->
                                        <StackPanel Margin="0">
                                            <ItemsControl ItemsSource="{Binding FilterList.CurrentPageFilters}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Button Content="{Binding DisplayText}"
                                                                Classes="filter-list-item"
                                                                IsPressed="{Binding IsSelected}"/>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Grid>
                                </ScrollViewer>

                                <!-- Pagination Controls -->
                                <StackPanel Grid.Row="1"
                                            Orientation="Horizontal"
                                            HorizontalAlignment="Center"
                                            Spacing="4"
                                            Margin="0,20,0,0">
                                    <Button Content="&lt;"
                                            Classes="btn-red"
                                            Width="44"
                                            Height="36"
                                            FontSize="16"
                                            Padding="0"
                                            CornerRadius="8"
                                            Command="{Binding FilterList.PreviousPageCommand}"/>

                                    <!-- Page indicator -->
                                    <Border Background="{StaticResource Red}"
                                            BorderBrush="Transparent"
                                            BorderThickness="0"
                                            CornerRadius="8"
                                            Padding="16,8"
                                            MinWidth="100"
                                            VerticalAlignment="Center">
                                        <TextBlock Text="{Binding FilterList.PageIndicatorText}"
                                                   FontFamily="{StaticResource BalatroFont}"
                                                   FontSize="14"
                                                   Foreground="White"
                                                   TextAlignment="Center"/>
                                    </Border>

                                    <Button Content="&gt;"
                                            Classes="btn-red"
                                            Width="44"
                                            Height="36"
                                            FontSize="16"
                                            Padding="0"
                                            CornerRadius="8"
                                            Command="{Binding FilterList.NextPageCommand}"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- RIGHT SIDE: Details Panel -->
                        <Border Grid.Column="2"
                                Background="{StaticResource DarkBackground}"
                                BorderThickness="0"
                                CornerRadius="8"
                                Padding="20">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>    <!-- Filter Details -->
                                    <RowDefinition Height="Auto"/> <!-- Action Buttons -->
                                </Grid.RowDefinitions>

                                <!-- Filter Details Area -->
                                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto"
                                              IsVisible="{Binding ShowDetailsPanel}">
                                    <StackPanel Spacing="15">
                                        <!-- Filter Name -->
                                        <TextBlock Text="{Binding FilterName}"
                                                   FontFamily="{StaticResource BalatroFont}"
                                                   FontSize="24"
                                                   Foreground="{StaticResource Gold}"
                                                   HorizontalAlignment="Center"
                                                   TextWrapping="Wrap"/>

                                        <!-- Author -->
                                        <TextBlock FontFamily="{StaticResource BalatroFont}"
                                                   FontSize="14"
                                                   Foreground="{StaticResource White}"
                                                   HorizontalAlignment="Center">
                                            <Run Text="by "/>
                                            <Run Text="{Binding FilterAuthor}"/>
                                        </TextBlock>

                                        <!-- Created Date -->
                                        <TextBlock FontFamily="{StaticResource BalatroFont}"
                                                   FontSize="12"
                                                   Foreground="{StaticResource ModalGrey}"
                                                   HorizontalAlignment="Center">
                                            <Run Text="Created: "/>
                                            <Run Text="{Binding CreatedDate}"/>
                                        </TextBlock>

                                        <!-- Description -->
                                        <TextBlock Text="{Binding FilterDescription}"
                                                   FontFamily="{StaticResource BalatroFont}"
                                                   FontSize="14"
                                                   Foreground="{StaticResource White}"
                                                   TextWrapping="Wrap"
                                                   HorizontalAlignment="Center"
                                                   TextAlignment="Center"
                                                   Margin="0,10,0,0"/>

                                        <!-- Filter Stats Section -->
                                        <StackPanel Spacing="12" Margin="0,20,0,0">
                                            <!-- Must Have -->
                                            <StackPanel Spacing="5">
                                                <TextBlock FontFamily="{StaticResource BalatroFont}"
                                                           FontSize="14"
                                                           Foreground="{StaticResource White}"
                                                           HorizontalAlignment="Center">
                                                    <Run Text="Must Have: "/>
                                                    <Run Text="{Binding MustHaveCount}"/>
                                                    <Run Text=" items"/>
                                                </TextBlock>
                                                <!-- TODO: Add item sprites preview here using SpritesService -->
                                            </StackPanel>

                                            <!-- Should Have -->
                                            <StackPanel Spacing="5">
                                                <TextBlock FontFamily="{StaticResource BalatroFont}"
                                                           FontSize="14"
                                                           Foreground="{StaticResource White}"
                                                           HorizontalAlignment="Center">
                                                    <Run Text="Should Have: "/>
                                                    <Run Text="{Binding ShouldHaveCount}"/>
                                                    <Run Text=" items"/>
                                                </TextBlock>
                                                <!-- TODO: Add item sprites preview here using SpritesService -->
                                            </StackPanel>

                                            <!-- Must Not -->
                                            <StackPanel Spacing="5">
                                                <TextBlock FontFamily="{StaticResource BalatroFont}"
                                                           FontSize="14"
                                                           Foreground="{StaticResource White}"
                                                           HorizontalAlignment="Center">
                                                    <Run Text="Must Not: "/>
                                                    <Run Text="{Binding MustNotCount}"/>
                                                    <Run Text=" items"/>
                                                </TextBlock>
                                                <!-- TODO: Add item sprites preview here using SpritesService -->
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </ScrollViewer>

                                <!-- Placeholder Message -->
                                <TextBlock Grid.Row="0"
                                           Text="{Binding PlaceholderText}"
                                           FontFamily="{StaticResource BalatroFont}"
                                           FontSize="18"
                                           Foreground="{StaticResource ModalGrey}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center"
                                           IsVisible="{Binding ShowPlaceholder}"/>

                                <!-- Action Buttons -->
                                <StackPanel Grid.Row="1"
                                            Spacing="8"
                                            Margin="0,20,0,0"
                                            IsVisible="{Binding ShowDetailsPanel}">

                                    <!-- SEARCH Button -->
                                    <Button Content="SEARCH"
                                            Classes="btn-blue"
                                            Height="45"
                                            FontSize="16"
                                            Command="{Binding SearchCommand}"
                                            IsVisible="{Binding EnableSearch}"/>

                                    <!-- EDIT Button -->
                                    <Button Content="EDIT"
                                            Classes="btn-blue"
                                            Height="45"
                                            FontSize="16"
                                            Command="{Binding EditCommand}"
                                            IsVisible="{Binding EnableEdit}"/>

                                    <!-- COPY Button -->
                                    <Button Content="COPY"
                                            Classes="btn-orange"
                                            Height="40"
                                            FontSize="14"
                                            Command="{Binding CopyCommand}"
                                            IsVisible="{Binding EnableCopy}"/>

                                    <!-- DELETE Button -->
                                    <Button Content="DELETE"
                                            Classes="btn-red"
                                            Height="40"
                                            FontSize="14"
                                            Command="{Binding DeleteCommand}"
                                            IsVisible="{Binding EnableDelete}"/>

                                    <!-- ANALYZE Button -->
                                    <Button Content="ANALYZE"
                                            Classes="btn-blue"
                                            Height="45"
                                            FontSize="16"
                                            Command="{Binding AnalyzeCommand}"
                                            IsVisible="{Binding EnableAnalyze}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>

                    <!-- Footer with BACK button -->
                    <Button Grid.Row="1"
                            Content="BACK"
                            Classes="back-button"
                            HorizontalAlignment="Stretch"
                            Command="{Binding BackCommand}"
                            Margin="0"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>

    <UserControl.Styles>
        <!-- Filter list item style (Balatro Challenges row spec) -->
        <Style Selector="Button.filter-list-item">
            <Setter Property="Background" Value="{StaticResource Red}"/>
            <Setter Property="Foreground" Value="{StaticResource White}"/>
            <Setter Property="FontFamily" Value="{StaticResource BalatroFont}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Height" Value="26"/>
            <Setter Property="Margin" Value="0,2"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="MinWidth" Value="210"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="12,2"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style Selector="Button.filter-list-item:pointerover">
            <Setter Property="Background" Value="{StaticResource HoverShadow}"/>
        </Style>

        <Style Selector="Button.filter-list-item:pressed">
            <Setter Property="Background" Value="{StaticResource HoverShadow}"/>
        </Style>

        <!-- Special blue styling for CREATE NEW FILTER -->
        <Style Selector="Button.create-new-item">
            <Setter Property="Background" Value="{StaticResource Blue}"/>
        </Style>

        <Style Selector="Button.create-new-item:pointerover">
            <Setter Property="Background" Value="{StaticResource Blue}"/>
        </Style>

        <Style Selector="Button.create-new-item:pressed">
            <Setter Property="Background" Value="{StaticResource Blue}"/>
        </Style>
    </UserControl.Styles>

</UserControl>
