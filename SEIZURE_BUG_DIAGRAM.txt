â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          BEFORE (BROKEN - SEIZURE BUG)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        Border (catches pointer events)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PointerEntered/Exited     â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  StackPanel          â”‚  â”‚
        â”‚  â”‚  (NO rotation)       â”‚  â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
        â”‚  â”‚  â”‚   Card Image   â”‚  â”‚  â”‚
        â”‚  â”‚  â”‚   [Joker]      â”‚  â”‚  â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
        â”‚  â”‚                      â”‚  â”‚
        â”‚  â”‚  DisplayName: Joker  â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PROBLEM: When card rotates (even slightly), the Border's bounds shift
         User hovers near edge â†’ Rotation shifts hitbox by 2px â†’ PointerExited
         Next frame â†’ Rotation shifts back â†’ PointerEntered
         FLICKER LOOP = SEIZURES


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AFTER (FIXED - HOTSPOT SEPARATION)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        Grid (container, 100x135px)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                        â”‚
        â”‚  LAYER 2 (Z-Index 1, TOP)             â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ Border (INVISIBLE HITBOX)        â”‚ â”‚
        â”‚  â”‚ Background="Transparent"         â”‚ â”‚
        â”‚  â”‚ Cursor="Hand"                    â”‚ â”‚
        â”‚  â”‚ PointerEntered/Exited HERE       â”‚ â”‚
        â”‚  â”‚ âš ï¸ NEVER ROTATES!                â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚           â”‚                            â”‚
        â”‚           â”‚ Overlays                   â”‚
        â”‚           â–¼                            â”‚
        â”‚  LAYER 1 (Z-Index 0, BOTTOM)          â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ StackPanel (VISUAL CARD)         â”‚ â”‚
        â”‚  â”‚ IsHitTestVisible="False"         â”‚ â”‚
        â”‚  â”‚ BalatroCardSwayBehavior attached â”‚ â”‚
        â”‚  â”‚ âœ¨ ROTATES FREELY!                â”‚ â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
        â”‚  â”‚  â”‚   Card Image   â”‚ â†» rotates    â”‚ â”‚
        â”‚  â”‚  â”‚   [Joker]      â”‚              â”‚ â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
        â”‚  â”‚  DisplayName: Joker              â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SOLUTION:
- Visual card (LAYER 1) rotates freely, but can't receive pointer events
- Invisible hitbox (LAYER 2) has FIXED bounds, catches all pointer events
- User sees: rotating card
- Avalonia sees: non-rotating hitbox
- NO FLICKER! âœ…


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SIDE-BY-SIDE COMPARISON                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   BEFORE (rotation affects hitbox)      â”‚     AFTER (rotation doesn't affect hitbox)
                                         â”‚
    Rotation at 0Â°:                      â”‚     Rotation at 0Â°:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† Fixed hitbox
    â”‚  Hitbox  â”‚ â† hitbox = visual       â”‚     â”‚          â”‚
    â”‚   â”Œâ”€â”€â”   â”‚                         â”‚     â”‚   â”Œâ”€â”€â”   â”‚ â† Visual card
    â”‚   â”‚ğŸƒâ”‚   â”‚                         â”‚     â”‚   â”‚ğŸƒâ”‚   â”‚
    â”‚   â””â”€â”€â”˜   â”‚                         â”‚     â”‚   â””â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
    Rotation at +5Â°:                     â”‚     Rotation at +5Â°:
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† hitbox shifted!    â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† Fixed hitbox (same!)
       â”‚  Hitbox  â”‚                      â”‚     â”‚          â”‚
       â”‚    â”â”â”â”“  â”‚                      â”‚     â”‚    â”â”â”â”“  â”‚ â† Visual card rotated
       â”‚    â”ƒğŸƒâ”ƒ  â”‚ Mouse exits!         â”‚     â”‚    â”ƒğŸƒâ”ƒ  â”‚
       â”‚    â”—â”â”â”›  â”‚                      â”‚     â”‚    â”—â”â”â”›  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â˜ ï¸ FLICKER                      â”‚         âœ… STABLE


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TECHNICAL IMPLEMENTATION                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY PROPERTIES:

1. Visual Card Layer (StackPanel):
   - ZIndex="0" ...................... Rendered first (bottom)
   - IsHitTestVisible="False" ........ CRITICAL - ignores all pointer events
   - RenderTransform (from Behavior) .. Rotates freely
   - Opacity binding .................. Fades during drag

2. Invisible Hitbox Layer (Border):
   - ZIndex="1" ...................... Rendered last (top)
   - Background="Transparent" ........ Must have background to catch events
   - NO RenderTransform .............. NEVER rotates
   - PointerPressed/Entered .......... Catches all user interaction

3. Container (Grid):
   - Width="100" Height="135" ........ Fixed size prevents layout shift
   - Margin="12,8" ................... Spacing between cards


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            EVENT FLOW DIAGRAM                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER ACTION: Hover over card

    1. Mouse cursor enters Grid bounds
       â†“
    2. Hit test encounters LAYER 2 (Border, Z-Index 1) FIRST
       â†“
    3. Border.PointerEntered fires
       â†“
    4. OnCardPointerEntered() called â†’ PlayCardHover() sound
       â†“
    5. Hit test NEVER reaches LAYER 1 (StackPanel has IsHitTestVisible="False")
       â†“
    6. BalatroCardSwayBehavior continues rotating LAYER 1 underneath
       â†“
    7. Border bounds stay PERFECTLY STILL (no rotation)
       â†“
    8. Mouse cursor stays inside Border bounds
       â†“
    9. âœ… NO PointerExited/PointerEntered loop!


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              WHY THIS WORKS                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AVALONIA HIT TESTING ALGORITHM:

    foreach (Visual child in children.OrderByDescending(v => v.ZIndex))
    {
        if (child.IsHitTestVisible && child.TransformedBounds.Contains(point))
        {
            return child; // First hit wins
        }
    }

WITH OUR FIX:
- Border (Z-Index 1) is checked FIRST
- Border.IsHitTestVisible = true (default)
- Border.TransformedBounds = FIXED (no rotation)
- Border.TransformedBounds.Contains(point) = TRUE â†’ Border catches event
- StackPanel is NEVER checked (IsHitTestVisible = false)

BEFORE THE FIX:
- Border (or single control) had rotation applied
- Border.TransformedBounds = VARIABLE (changes with rotation)
- Border.TransformedBounds.Contains(point) = UNSTABLE
- Edge pixels flip between inside/outside bounds
- PointerEntered/Exited fire repeatedly


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GAME DEV INDUSTRY STANDARD                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

This pattern is used in:
- Unity: GameObject (visual) + Collider (hitbox) separation
- Unreal: StaticMesh (visual) + Collision Component (hitbox) separation
- Godot: Sprite (visual) + Area2D (hitbox) separation
- HTML5 Canvas games: Draw layer + interaction layer separation
- WPF/WinUI: Same pattern for touch/mouse on rotating elements

WHY IT'S STANDARD:
1. Decouples visuals from interaction
2. Allows complex animations without breaking input
3. Enables hitbox tuning (can be bigger/smaller than visual)
4. Performance: hit testing on simple shapes, not complex rotated bounds
5. Accessibility: interaction layer can have different properties
